<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>DLL基础 - sYstemk1t&#039;s blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="sYstemk1t"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="sYstemk1t"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta description="动态链接库(DLL)一直是Windows操作系统得基础。WindowsAPI中得得所有函数都包含在DLL中。3个重要得DLL是Kernel32.dll，它用于内存管理、进程和线程得各个函数；User32.dll，它用于执行用户交互界面任务得各个函数；GDI32.dll，它用于画图和显示文本得各个函数。"><meta property="og:type" content="blog"><meta property="og:title" content="DLL基础"><meta property="og:url" content="http://systemk1t.github.io/2019/10/01/DLL%E5%9F%BA%E7%A1%80/"><meta property="og:site_name" content="sYstemk1t&#039;s blog"><meta property="og:description" content="动态链接库(DLL)一直是Windows操作系统得基础。WindowsAPI中得得所有函数都包含在DLL中。3个重要得DLL是Kernel32.dll，它用于内存管理、进程和线程得各个函数；User32.dll，它用于执行用户交互界面任务得各个函数；GDI32.dll，它用于画图和显示文本得各个函数。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://systemk1t.github.io/2019/10/01/DLL%E5%9F%BA%E7%A1%80/0.png"><meta property="article:published_time" content="2019-10-01T00:56:50.000Z"><meta property="article:modified_time" content="2019-10-03T01:43:07.445Z"><meta property="article:author" content="sYstemk1t"><meta property="article:tag" content="Windows-Kernel"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/2019/10/01/DLL%E5%9F%BA%E7%A1%80/0.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://systemk1t.github.io/2019/10/01/DLL%E5%9F%BA%E7%A1%80/"},"headline":"sYstemk1t's blog","image":["http://systemk1t.github.io/2019/10/01/DLL%E5%9F%BA%E7%A1%80/0.png"],"datePublished":"2019-10-01T00:56:50.000Z","dateModified":"2019-10-03T01:43:07.445Z","author":{"@type":"Person","name":"sYstemk1t"},"description":"动态链接库(DLL)一直是Windows操作系统得基础。WindowsAPI中得得所有函数都包含在DLL中。3个重要得DLL是Kernel32.dll，它用于内存管理、进程和线程得各个函数；User32.dll，它用于执行用户交互界面任务得各个函数；GDI32.dll，它用于画图和显示文本得各个函数。"}</script><link rel="canonical" href="http://systemk1t.github.io/2019/10/01/DLL%E5%9F%BA%E7%A1%80/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="fontawesome"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.2.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/head.jpg" alt="sYstemk1t&#039;s blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2019-10-01T00:56:50.000Z" title="2019-10-01T00:56:50.000Z">2019-10-01</time>发表</span><span class="level-item"><time dateTime="2019-10-03T01:43:07.445Z" title="2019-10-03T01:43:07.445Z">2019-10-03</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Windows%E6%A0%B8%E5%BF%83%E7%BC%96%E7%A8%8B/">Windows核心编程</a></span><span class="level-item">32 分钟读完 (大约4770个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">DLL基础</h1><div class="content"><hr>
<hr>
<p>动态链接库(DLL)一直是Windows操作系统得基础。WindowsAPI中得得所有函数都包含在DLL中。3个重要得DLL是Kernel32.dll，它用于内存管理、进程和线程得各个函数；User32.dll，它用于执行用户交互界面任务得各个函数；GDI32.dll，它用于画图和显示文本得各个函数。</p>
<a id="more"></a>



<h1 id="DLL基础"><a href="#DLL基础" class="headerlink" title="DLL基础"></a>DLL基础</h1><p>使用DLL的一些原因：</p>
<ul>
<li>扩展了程序的特性，DLL可以动态的装入进程的地址空间，因此应用程序可以在运行时装入相应的代码，以便根据需要执行这些操作</li>
<li>可以使用多种语言来编程</li>
<li>简化了软件项目的管理，可以实现模块化开发</li>
<li>节约内存，如果多个程序使用同一个DLL，那么只需要被装入内存一次，所有程序都可以共享它的各个页面</li>
<li>资源的共享，DLL可以实现多个程序使用DLL来共享资源</li>
<li>有助于程序本地化，应用程序常常使用DLL对自己进行本地化</li>
<li>解决平台差异，不同的WIndows版本配有不同的函数</li>
<li>可以实现一些特殊目的，例如钩子</li>
</ul>
<h2 id="DLL与进程的地址空间"><a href="#DLL与进程的地址空间" class="headerlink" title="DLL与进程的地址空间"></a>DLL与进程的地址空间</h2><p>创建DLL比创建应用程序更容易，因为DLL往往包含一组应用程序可以使用的自主函数，DLL只是一组源代码模块，每个模块包含了应用程序(可执行文件)或另一个DLL将要调用的一组函数。当所有源代码文件编译后，它们就像应用程序的执行文件那样被链接程序所链接。</p>
<p><strong>对于DLL来说，必须设定该连链程序的/DLL开关</strong></p>
<p>在应用程序（或DLL）能够调用DLL中的函数之前，DLL问价你必须被映射到调用进程的地址空间中。一旦DLL文件被映像到调用进程的地址空间中，DLL的函数就可以供进程中的运行的所有线程使用。</p>
<p><strong>当一个线程需要调用DLL函数的时候，该DLL函数要查看线程的堆栈，以便检索它传递的参数，并将线程的堆栈用于它需要的任何局部变量，DLL中的代码创建的任何对象由调用线程所拥有，DLL本身不拥有任何东西</strong></p>
<p><strong>DLL库中的全局和静态变量也受写时复制机制保护。这样多个进程载入同一个DLL并不会互相破坏数据。</strong></p>
<ul>
<li>单个地址空间是由一个可执行模块和若干个DLL模块组成的</li>
<li>模块中有些可以链接到静态版本的C/C++运行期库，有些可以链接到一个DLL版本的C/C++运行期库</li>
<li>有些模块不需要C/C++运行期库</li>
</ul>
<p><strong>若干个C/C++运行期库可以存在于单个地址空间中</strong></p>
<h2 id="DLL的总体运行情况"><a href="#DLL的总体运行情况" class="headerlink" title="DLL的总体运行情况"></a>DLL的总体运行情况</h2><p><img src="/2019/10/01/DLL%E5%9F%BA%E7%A1%80/0.png"></p>
<p>DLL中导入函数和变量的模块称为“可执行模块”</p>
<p>导出函数和变量以供可执行文件使用的模块称为“DLL模块” ， DLL模块也可以导入一些包含在其他DLL模块中的函数和变量。</p>
<p>如果一个可执行模块要从另一个DLL模块中导入函数和变量，必须先构建该DLL模块，然后再构建可执行模块。</p>
<p>构建DLL的步骤：</p>
<ul>
<li>创建一个头文件，包含了要在DLL中导出的函数原型，结构以及符号等。 DLL的所有源文件都必须包含这个头文件</li>
<li>创建CPP文件来实现DLL模块中导出的函数和变量。</li>
<li>构建DLL模块的时候，编译器会对每个源文件进行处理并产生一个obj模块（每个源文件对应一个obj模块）</li>
<li>所有obj模块都创建完毕以后，连接器会将所有obj模块的内容合并起来，产生一个单独的DLL映像文件。映像文件保护所有DLL的二进制代码以及全局静态变量。</li>
<li>连接器检测到DLL的源文件输出了至少一个函数或变量。连接器还会创建一个.lib文件。这个.lib文件非常小，因为它并不包含任何函数或变量。它只是列出了所有被导出的函数和变量的符号名。为了构建可执行模块，这个文件是必须的。</li>
</ul>
<p>构建可执行模块：</p>
<ul>
<li><p>所有引用了DLL的导出函数，变量，数据结构或符号的源文件中，必须包含由DLL的开发人员所创建的头文件。</p>
</li>
<li><p>创建C/C++源文件来实现想要包含在可执行模块中的函数和变量。可以引用DLL的头文件中定义的函数和变量</p>
</li>
<li><p>在构建可执行模块的时候，编译器会对每个源文件进行处理并产生一个obj模块（每个源文件对应一个obj模块）</p>
</li>
<li><p>所有obj模块都创建完毕以后，连接器会将所有obj模块的内容合并起来，产生一个单独的可执行映像文件。这个映像文件包含了可执行文件中所有的二进制代码以及静态全局变量。该可执行模块还包含一个导入段（import section， .idata）列出了所有它需要的DLL模块的名称。 对于列出的每个DLL还记录了可执行文件的二进制代码从中引用的函数和变量的符号名。（操作系统的加载程序会解析这个导入段）</p>
</li>
<li><p>一旦DLL和可执行模块都构建完毕，进程就可以执行了。当试图运行可执行模块的时候，操作系统的加载程序会执行以下步骤。</p>
<ul>
<li>加载程序为新进程床架你一个虚拟地址空间，并将可执行模块映射到新进程的地址空间中</li>
<li>加载程序接着解析可执行模块的导入段。对导入段列出的每个DLL，加载程序会在用户的系统中对该DLL模块进行定位，并将该DLL映射到进程的地址空间中。</li>
<li>由于DLL可能导入其他DLL模块中的函数和变量，因此DLL模块可能还有自己的导入段并需要将它所需的DLL模块也映射到进程地址空间，初始化可能会耗费很长的时间。</li>
</ul>
<p>一旦加载程序将可执行模块和所有DLL模块映射到进程的地址空间以后，进程的主线程可以开始执行，这样应用程序就能运行了。</p>
</li>
</ul>
<h2 id="创建DLL模块"><a href="#创建DLL模块" class="headerlink" title="创建DLL模块"></a>创建DLL模块</h2><p>dll可以导出函数，变量或C++类。</p>
<p>通常不应该导出变量，这等于去掉了代码的抽象层</p>
<p>也不应该导出C++类，除非调用方和构建DLL方使用相同的编译器。（C++语言生成的二进制代码具有编译器依赖性）</p>
<p>创建DLL的时候，首先应该创建头文件来包含想要导出的变量（类型和名称）和函数。这个头文件还必须定义导出的函数或变量所用到的任何符号和数据结构。</p>
<p>DLL的所有源文件都必须包含这个头文件。还必须随DLL一起发布这个头文件。这样任何可能需要导入这些函数或变量的源文件就可以包含该头文件。</p>
<p>代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/************************************************************************/</span></span><br><span class="line"><span class="comment">/* Module : MyLib.h                                                     */</span></span><br><span class="line"><span class="comment">/************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> MYLIBAPI_HEADER</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MYLIBAPI_HEADER</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> MYLIBAPI</span></span><br><span class="line"><span class="comment">// MYLIBAPI shoulde be defined in all of the DLL&#x27;s source</span></span><br><span class="line"><span class="comment">// code modules before this header file is included.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// All functions/variables are being exported.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="comment">// This header file is included by an EXE source code module.</span></span><br><span class="line"><span class="comment">// Indicate that all functions/variables are being imported.</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MYLIBAPI extern <span class="meta-string">&quot;C&quot;</span> __declspec(dllimport)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Define any data structures and symbols here.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Define exported variables here. (<span class="doctag">NOTE:</span> Avoid exporting variables.)</span></span><br><span class="line">MYLIBAPI <span class="keyword">int</span> g_nResult;</span><br><span class="line"></span><br><span class="line"><span class="comment">//////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Define exported function prototypes here.</span></span><br><span class="line"><span class="function">MYLIBAPI <span class="keyword">int</span> <span class="title">Add</span><span class="params">(<span class="keyword">int</span> nLeft, <span class="keyword">int</span> nRight)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>



<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/************************************************************************/</span></span><br><span class="line"><span class="comment">/*     Module: MyLibFile1.cpp                                           */</span></span><br><span class="line"><span class="comment">/************************************************************************/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Include the standard windows and C-Runtime header files here.</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// This DLL source code file exports functions and variables.</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MYLIBAPI extern <span class="meta-string">&quot;C&quot;</span> __declspec(dllexport)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Included the exported data structures, symbols, functions, and variables.</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;mylib.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Place the code for this DLL source code file here.</span></span><br><span class="line"><span class="keyword">int</span> g_nResult;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Add</span><span class="params">(<span class="keyword">int</span> nLeft, <span class="keyword">int</span> nRight)</span> </span>&#123;</span><br><span class="line">	g_nResult = nLeft + nRight;</span><br><span class="line">	<span class="keyword">return</span> g_nResult;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">///////////////////////////// End of File ////////////////////////////////</span></span><br></pre></td></tr></table></figure>





<p>在编译前面的DLL源文件时，MYLIBAPI在包含Mylib.h之前被定义为<br>__declspec(dllexport) 这样编译器看到被它修饰的变量函数，就知道应该在DLL模块中导出该变量，函数或C++类。</p>
<p>在cpp文件中，不必在被导出的变量和函数前面加MYLIBAPI标识符。因为在解析头文件的时候编译器已经记住了应该要导出哪些变量或函数</p>
<p>extern “C”修饰符告知编译器在编写C++代码的时候，以C语言的方式来编译不会使用修饰符。</p>
<p>C++编译器通常会对函数名进行改写。</p>
<p>如果后续被c语言编写的可执行文件引用，c编译器不会对函数名进行改写。但是在链接的时候会找不到所引用的C++函数名（以及被C++编译器改写了）</p>
<p>extern “C”告知编译器不要对函数名进行改写</p>
<p>在可执行文件中引用dll的头文件的时候应该使用__declspec(dllimport)这样编译器就知道可执行文件的源文件要从DLL模块导入一些变量和函数。</p>
<h2 id="导出函数"><a href="#导出函数" class="headerlink" title="导出函数"></a>导出函数</h2><p>__declspec(dllexport)修改符，当C/C++编译器看到变量、函数原型、C++类之前的这个修改符的时候，它就将某些附加信息嵌入产生的/obj文件中。当链接DLL的所有.obj文件的时候，链接程序将对这些信息进行分析</p>
<p>.Lib文件包含一个DLL输出的符号列表，除了创建.lib文件以外，链接程序还要将一个输出符号表嵌入产生的DLL文件中，这个输出节彪悍一个输出变量、函数和类符号的列表。该链接程序还能指明在何处找到每个符号的相对虚拟地址（RAV）放入DLL模块</p>
<p>使用dumpbin(带有-exports开关)查看我们生成的DLL</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">F:\Code\Kernel_Code\DLL\MyLib\Mylib\Mylib&gt;dumpbin -exports MyLibFile1.dll</span><br><span class="line">Microsoft (R) COFF Binary File Dumper Version 6.00.8168</span><br><span class="line">Copyright (C) Microsoft Corp 1992-1998. All rights reserved.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Dump of file MyLibFile1.dll</span><br><span class="line"></span><br><span class="line">File Type: DLL</span><br><span class="line"></span><br><span class="line">  Section contains the following exports for MyLibFile1.dll</span><br><span class="line"></span><br><span class="line">           0 characteristics</span><br><span class="line">    5D954650 time date stamp Thu Oct 03 08:52:32 2019</span><br><span class="line">        0.00 version</span><br><span class="line">           1 ordinal base</span><br><span class="line">           2 number of functions</span><br><span class="line">           2 number of names</span><br><span class="line"></span><br><span class="line">    ordinal hint RVA      name</span><br><span class="line"></span><br><span class="line">          1    0 00001000 Add</span><br><span class="line">          2    1 00008430 g_nResult</span><br><span class="line"></span><br><span class="line">  Summary</span><br><span class="line"></span><br><span class="line">        3000 .data</span><br><span class="line">        1000 .rdata</span><br><span class="line">        1000 .reloc</span><br><span class="line">        4000 .text</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>符号是按照字母排序的。 RVA表示一个偏移量，导出符号位于dll文件映像中的这个位置。</p>
<p>ordinal是为了兼容16位windows源码保持向后兼容保留的。</p>
<p>你可以将序号用于你创建的任何D L L，并且按照序号将你的可执行文件链接到这<br>些D L L。M i c r o s o f t保证，即使在将来的操作系统版本中，这个方法也是可行的。但是在我的工作中总是避免使用序号，并且从现在起只按名字进行链接。</p>
<h2 id="创建用于非VC-工具的DLL"><a href="#创建用于非VC-工具的DLL" class="headerlink" title="创建用于非VC++工具的DLL"></a>创建用于非VC++工具的DLL</h2><p>如果创建DLL和可执行文件使用的都是VC++那么没什么问题。如果VC++创建的DLL要与其他厂商工具包构建的可执行文件链接，就必须做一个些额外的工作。</p>
<p>当以__stdcall (WINAPI)导出函数的时候，MS的C编译器也会对函数进行改名。 例如以下函数</p>
<p>__declspec(dllexport) LONG __stdcall MyFunc(int a, int b);</p>
<p>编译以后导出的符号是 _MyFunc@8   8表示传递给函数参数的字节数。</p>
<p>如果使用另一个工具来构建可执行文件的时候，连接器将试图连接到一个名为MyFunc的函数。由于该函数在VC++构建的DLL中并不存在，因此链接会失败。</p>
<p>为了使用VC++构建的DLL能被其他编译工具正常导入使用，必须告知MS编译器不要对导出函数进行改名。可以通过两种方法来达到这一幕的。</p>
<p>1）使用.def文件。 在.def文件下包含类似下面的EXPORTS字段</p>
<p>EXPORTS</p>
<p>MyFunc</p>
<p>当MS的连接器解析这个.def文件的时候，会发现_MyFunc@8和MyFunc都被导出。由于两个函数名是匹配的，因此连接器会用.def文件定义的名称。</p>
<p>如果想要避免使用.def文件，可以使用第二种方法输出未阶段的函数版本，在DLL的源代码中，可以添加下面这行代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(linker,<span class="meta-string">&quot;/export:MyFunc=_MyFunc@8&quot;</span>)</span></span><br></pre></td></tr></table></figure>

<p>这会直接指示编译器产生一个连接器指示符，该指示符告诉连接器要导出一个名为MyFunc的函数，该函数入口和_MyFunc@8相同。</p>
<h3 id="构建可执行模块"><a href="#构建可执行模块" class="headerlink" title="构建可执行模块"></a>构建可执行模块</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _CRT_SECURE_NO_WARNINGS</span></span><br><span class="line"><span class="comment">/************************************************************************/</span></span><br><span class="line"><span class="comment">/*        Module: MyExeFile1.cpp                                        */</span></span><br><span class="line"><span class="comment">/************************************************************************/</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// Include the standard windows and C-Runtime header files here.</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;tchar.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;strsafe.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">// Include the exported data structures, symbols, functions, and variables.</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;MyLib.h&quot;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">int</span> _tmain(<span class="keyword">int</span> argc, TCHAR* argv[], TCHAR * env[])</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">int</span> nLeft = <span class="number">10</span>, nRight = <span class="number">25</span>;</span><br><span class="line"> </span><br><span class="line">	TCHAR sz[<span class="number">100</span>];</span><br><span class="line">	StringCchPrintf(sz, _countof(sz), TEXT(<span class="string">&quot;%d + %d = %d&quot;</span>),</span><br><span class="line">		nLeft, nRight, Add(nLeft, nRight));</span><br><span class="line">	MessageBox(<span class="literal">NULL</span>, sz, TEXT(<span class="string">&quot;Calculation&quot;</span>), MB_OK);</span><br><span class="line"> </span><br><span class="line">	StringCchPrintf(sz, _countof(sz),</span><br><span class="line">		TEXT(<span class="string">&quot;The result from the last Add is : %d&quot;</span>), g_nResult);</span><br><span class="line">	MessageBox(<span class="literal">NULL</span>, sz, TEXT(<span class="string">&quot;Last Result&quot;</span>), MB_OK);</span><br><span class="line"> </span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="导入函数"><a href="#导入函数" class="headerlink" title="导入函数"></a>导入函数</h2><p>__declspec(dllimports)，当输入一个符号，不必使用关键，只需要使用标准的C关键字extern即可。</p>
<p>在导入符号的时候，不必使用__declspec(dllimport)关键字，可以直接使用标准C的extern关键字。</p>
<p>但是如果编译器能提前知道我们引用的符号是从DLL的.lib导入，那么能够产生略微高效的代码。有鉴于此，作者建议尽量在导入函数和数据符号的时候使用__declspec(dllimport)关键字。</p>
<p>连接器在解决导入符号的时候，会在生成的可执行模块嵌入一个导入段（import section）导入段列出了该模块所需的DLL模块，以及它从每个DLL模块中引用的符号。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">F:\Code\Kernel_Code\DLL\MyLib\Mylib\Mylib&gt;dumpbin -imports</span><br><span class="line">Microsoft (R) COFF/PE Dumper Version 12.00.40629.0</span><br><span class="line">Copyright (C) Microsoft Corporation.  All rights reserved.</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">Dump of file SubProcess.exe</span><br><span class="line"> </span><br><span class="line">File Type: EXECUTABLE IMAGE</span><br><span class="line"> </span><br><span class="line">  Section contains the following imports:</span><br><span class="line"> </span><br><span class="line">    MyLib.dll</span><br><span class="line">                41915C Import Address Table</span><br><span class="line">                419380 Import Name Table</span><br><span class="line">                     0 time date stamp</span><br><span class="line">                     0 Index of first forwarder reference</span><br><span class="line"> </span><br><span class="line">                    1 g_nResult</span><br><span class="line">                    0 Add</span><br><span class="line"> </span><br><span class="line">    USER32.dll</span><br><span class="line">                419190 Import Address Table</span><br><span class="line">                4193B4 Import Name Table</span><br><span class="line">                     0 time date stamp</span><br><span class="line">                     0 Index of first forwarder reference</span><br><span class="line"> </span><br><span class="line">                  24D MessageBoxW</span><br><span class="line"> </span><br><span class="line">    MSVCR120D.dll</span><br><span class="line">                419090 Import Address Table</span><br><span class="line">                4192B4 Import Name Table</span><br><span class="line">                     0 time date stamp</span><br><span class="line">                     0 Index of first forwarder reference</span><br><span class="line"> </span><br><span class="line">                  26E _commode</span><br><span class="line">                  282 _crt_debugger_hook</span><br><span class="line">                  1CE __crtUnhandledException</span><br><span class="line">                  1CD __crtTerminateProcess</span><br><span class="line">                  137 ?terminate@@YAXXZ</span><br><span class="line">                  2D6 _fmode</span><br><span class="line">                  3CB _lock</span><br><span class="line">                  53F _unlock</span><br><span class="line">                  25B _calloc_dbg</span><br><span class="line">                  1D0 __dllonexit</span><br><span class="line">                  473 _onexit</span><br><span class="line">                  34B _invoke_watson</span><br><span class="line">                  272 _controlfp_s</span><br><span class="line">                  2AD _except_handler4_common</span><br><span class="line">                  7C6 wcscpy_s</span><br><span class="line">                  5DD _wmakepath_s</span><br><span class="line">                  5FF _wsplitpath_s</span><br><span class="line">                  22E __winitenv</span><br><span class="line">                  345 _initterm</span><br><span class="line">                  346 _initterm_e</span><br><span class="line">                  219 __setusermatherr</span><br><span class="line">                  26F _configthreadlocale</span><br><span class="line">                  25C _cexit</span><br><span class="line">                  2B6 _exit</span><br><span class="line">                  68F exit</span><br><span class="line">                  16E _CrtSetCheckCount</span><br><span class="line">                  15D _CrtDbgReportW</span><br><span class="line">                  217 __set_app_type</span><br><span class="line">                  22D __wgetmainargs</span><br><span class="line">                  244 _amsg_exit</span><br><span class="line">                  18D _XcptFilter</span><br><span class="line">                  157 _CRT_RTC_INITW</span><br><span class="line">                  56A _vsnwprintf</span><br><span class="line">                  1CB __crtSetUnhandledExceptionFilter</span><br><span class="line"> </span><br><span class="line">    KERNEL32.dll</span><br><span class="line">                419000 Import Address Table</span><br><span class="line">                419224 Import Name Table</span><br><span class="line">                     0 time date stamp</span><br><span class="line">                     0 Index of first forwarder reference</span><br><span class="line"> </span><br><span class="line">                  267 GetModuleHandleW</span><br><span class="line">                  263 GetModuleFileNameW</span><br><span class="line">                  19E FreeLibrary</span><br><span class="line">                  5A3 VirtualQuery</span><br><span class="line">                  333 HeapFree</span><br><span class="line">                  32F HeapAlloc</span><br><span class="line">                   FE DecodePointer</span><br><span class="line">                  2D6 GetSystemTimeAsFileTime</span><br><span class="line">                  20E GetCurrentThreadId</span><br><span class="line">                  20A GetCurrentProcessId</span><br><span class="line">                  42D QueryPerformanceCounter</span><br><span class="line">                  36D IsProcessorFeaturePresent</span><br><span class="line">                  5CD WideCharToMultiByte</span><br><span class="line">                  3D1 MultiByteToWideChar</span><br><span class="line">                  3A7 LoadLibraryExW</span><br><span class="line">                  29D GetProcAddress</span><br><span class="line">                  250 GetLastError</span><br><span class="line">                  440 RaiseException</span><br><span class="line">                  367 IsDebuggerPresent</span><br><span class="line">                  121 EncodePointer</span><br><span class="line">                  2A2 GetProcessHeap</span><br><span class="line"> </span><br><span class="line">  Summary</span><br><span class="line"> </span><br><span class="line">        1000 .data</span><br><span class="line">        1000 .idata</span><br><span class="line">        3000 .rdata</span><br><span class="line">        1000 .reloc</span><br><span class="line">        1000 .rsrc</span><br><span class="line">        4000 .text</span><br><span class="line">       10000 .textbss</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>紧靠符号名左边的数字是符号的提示（ h i n t）值，它与讨论无关。每个符号行最左边的数字用于指明该符号在进程的地址空间中所在的内存地址。该内存地址只有在可执行模块相链接时才出现。在D u m p B i n的输出的结尾处，可以看到更多的链接信息。</p>
<h2 id="运行可执行模块"><a href="#运行可执行模块" class="headerlink" title="运行可执行模块"></a>运行可执行模块</h2><p>启动一个可执行模块的时候，操作系统的加载程序会先为进程创建虚拟地址空间，接着把可执行模块映射到进程的地址空间中。之后加载程序会检查可执行模块的导入段，试图对所需要的DLL进行定位并将它们映射到进程的地址空间中。</p>
<p>由于导入段只包含DLL名称，不包含DLL路径，加载程序必须在用户的磁盘上搜索。以下是搜索顺序：</p>
<p>1）包含可执行文件的目录</p>
<p>2）Windows的系统目录，该目录可以通过GetSystemDirectory得到。</p>
<p>3）16位的系统目录，即Windows目录中的System子目录</p>
<p>4）Windows目录，该目录可以通过GetWindowsDirectory得到</p>
<p>5）进程当前目录</p>
<p>6）PATH环境变量所列出的目录</p>
<p>为了防止载入伪造的系统DLL，所以搜索顺序优先是Windows系统目录。</p>
<p>如果加载程序无法找到所需的DLL模块，会提示一个找不到xxx.dll的提示框。</p>
<p>当加载程序将所有DLL模块都载入并映射到进程地址空间以后，开始修复所有导入符号的引用。为了完成这一个工作，它会再次查看每个模块的导入段。</p>
<p>对导入段中列出的每个符号，加载程序会检查对应DLL的导出段，看该符号是否存在。如果该符号不存在。加载程序会弹出错误提示。</p>
<p>如果该符号存在，加载程序会取得该符号的RVA并给它加上DLL模块被载入到的虚拟地址。接着加载程序会将这个虚拟地址保存到可执行模块的导入段中。</p>
<p>接着当代码引用一个导入符号的时候，会查看调用模块的导入段并得到被导入符号的地址。就能正常访问被导入的变量，函数或C++类成员函数。</p>
<p>动态链接就这样完成了。</p>
<p>注：由于加载模块需要加载所有DLL模块，并用所有导出符号的正确地址来修复每个导入模块的导入段，这需要相当长的时间。不过这只发生在程序加载过程中，并不影响程序的运行。</p>
<p>为了减少载入时间，可以堆自己的可执行模块和DLL模块进行基地址重定位和绑定。</p>
</div><div class="article-licensing box"><div class="licensing-title"><p>DLL基础</p><p><a href="http://systemk1t.github.io/2019/10/01/DLL%E5%9F%BA%E7%A1%80/">http://systemk1t.github.io/2019/10/01/DLL%E5%9F%BA%E7%A1%80/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>sYstemk1t</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2019-10-01</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2019-10-03</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a class="icon" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a><a class="icon" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Windows-Kernel/">Windows-Kernel</a></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><div class="social-share"></div><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button donate" href="/" target="_blank" rel="noopener" data-type="afdian"><span class="icon is-small"><i class="fas fa-charging-station"></i></span><span>爱发电</span></a><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>支付宝</span><span class="qrcode"><img src="/img/alipayimg.jpg" alt="支付宝"></span></a><a class="button donate" href="/" target="_blank" rel="noopener" data-type="buymeacoffee"><span class="icon is-small"><i class="fas fa-coffee"></i></span><span>送我杯咖啡</span></a><a class="button donate" href="/" target="_blank" rel="noopener" data-type="patreon"><span class="icon is-small"><i class="fab fa-patreon"></i></span><span>Patreon</span></a><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/img/wechatimg.jpg" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2019/10/03/DLL%E9%AB%98%E7%BA%A7%E6%8A%80%E6%9C%AF/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">DLL高级技术</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2019/09/30/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86-32%E4%BD%8D%E5%AF%84%E5%AD%98%E5%99%A8/"><span class="level-item">逆向工程核心原理-32位寄存器</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div class="notification is-danger">You forgot to set the <code>shortname</code> for Disqus. Please set it in <code>_config.yml</code>.</div></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="sYstemk1t"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">sYstemk1t</p><p class="is-size-6 is-block">翩若惊鸿，婉若游龙</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>ShenZhen, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">133</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">20</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">13</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/sYstemk1t" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/sYstemk1t"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://r00tk1ts.github.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">r00tk1t</span></span><span class="level-right"><span class="level-item tag">r00tk1ts.github.io</span></span></a></li><li><a class="level is-mobile" href="https://www.cnblogs.com/yicunyiye/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">yicunyiye</span></span><span class="level-right"><span class="level-item tag">www.cnblogs.com</span></span></a></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Bugku/"><span class="level-start"><span class="level-item">Bugku</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/C/"><span class="level-start"><span class="level-item">C++</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/C-%E9%BB%91%E5%AE%A2%E7%BC%96%E7%A8%8B/"><span class="level-start"><span class="level-item">C++黑客编程</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/CrackMe/"><span class="level-start"><span class="level-item">CrackMe</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/C%E4%B8%8E%E6%8C%87%E9%92%88/"><span class="level-start"><span class="level-item">C与指针</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80/"><span class="level-start"><span class="level-item">C程序设计语言</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/Windows-API%E5%BC%80%E5%8F%91%E8%AF%A6%E8%A7%A3/"><span class="level-start"><span class="level-item">Windows-API开发详解</span></span><span class="level-end"><span class="level-item tag">15</span></span></a></li><li><a class="level is-mobile" href="/categories/Windows-PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97/"><span class="level-start"><span class="level-item">Windows-PE权威指南</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/Windows32%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80%E8%AE%BE%E8%AE%A1/"><span class="level-start"><span class="level-item">Windows32汇编语言设计</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/Windows%E5%86%85%E6%A0%B8%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E7%8E%B0/"><span class="level-start"><span class="level-item">Windows内核原理与实现</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Windows%E6%A0%B8%E5%BF%83%E7%BC%96%E7%A8%8B/"><span class="level-start"><span class="level-item">Windows核心编程</span></span><span class="level-end"><span class="level-item tag">17</span></span></a></li><li><a class="level is-mobile" href="/categories/Windows%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/"><span class="level-start"><span class="level-item">Windows程序设计</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%8A%A0%E5%AF%86%E4%B8%8E%E8%A7%A3%E5%AF%86/"><span class="level-start"><span class="level-item">加密与解密</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%8F%8D%E6%B1%87%E7%BC%96/"><span class="level-start"><span class="level-item">反汇编</span></span><span class="level-end"><span class="level-item tag">25</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/"><span class="level-start"><span class="level-item">汇编语言</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80-%E5%9F%BA%E4%BA%8Ex86%E5%A4%84%E7%90%86%E5%99%A8/"><span class="level-start"><span class="level-item">汇编语言-基于x86处理器</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/"><span class="level-start"><span class="level-item">网络编程</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97/"><span class="level-start"><span class="level-item">逆向工程权威指南</span></span><span class="level-end"><span class="level-item tag">16</span></span></a></li><li><a class="level is-mobile" href="/categories/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/"><span class="level-start"><span class="level-item">逆向工程核心原理</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/categories/%E9%BB%91%E5%AE%A2%E7%BC%96%E7%A8%8B/"><span class="level-start"><span class="level-item">黑客编程</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-11-03T12:32:13.000Z">2020-11-03</time></p><p class="title"><a href="/2020/11/03/Windows%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F-%E5%86%85%E5%AD%98%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6/">Windows应用程序 - 内存映射文件</a></p><p class="categories"><a href="/categories/Windows-API%E5%BC%80%E5%8F%91%E8%AF%A6%E8%A7%A3/">Windows-API开发详解</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-11-03T07:26:22.000Z">2020-11-03</time></p><p class="title"><a href="/2020/11/03/Windows%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F-%E6%96%87%E4%BB%B6/">Windows应用程序 - 文件</a></p><p class="categories"><a href="/categories/Windows-API%E5%BC%80%E5%8F%91%E8%AF%A6%E8%A7%A3/">Windows-API开发详解</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-11-02T08:54:52.000Z">2020-11-02</time></p><p class="title"><a href="/2020/11/02/Windows%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F-%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E4%B8%8E%E7%89%A9%E7%90%86%E5%86%85%E5%AD%98/">Windows应用程序 - 虚拟内存与物理内存</a></p><p class="categories"><a href="/categories/Windows-API%E5%BC%80%E5%8F%91%E8%AF%A6%E8%A7%A3/">Windows-API开发详解</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-11-02T06:11:14.000Z">2020-11-02</time></p><p class="title"><a href="/2020/11/02/Windows%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F-%E4%BA%8B%E4%BB%B6/">Windows应用程序 - 事件</a></p><p class="categories"><a href="/categories/Windows-API%E5%BC%80%E5%8F%91%E8%AF%A6%E8%A7%A3/">Windows-API开发详解</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-11-02T03:00:33.000Z">2020-11-02</time></p><p class="title"><a href="/2020/11/02/Windows%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F-%E4%BA%92%E6%96%A5%E9%87%8F/">Windows应用程序 - 互斥量</a></p><p class="categories"><a href="/categories/Windows-API%E5%BC%80%E5%8F%91%E8%AF%A6%E8%A7%A3/">Windows-API开发详解</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2020/11/"><span class="level-start"><span class="level-item">十一月 2020</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/10/"><span class="level-start"><span class="level-item">十月 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/09/"><span class="level-start"><span class="level-item">九月 2020</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/08/"><span class="level-start"><span class="level-item">八月 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/07/"><span class="level-start"><span class="level-item">七月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/05/"><span class="level-start"><span class="level-item">五月 2020</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/04/"><span class="level-start"><span class="level-item">四月 2020</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/01/"><span class="level-start"><span class="level-item">一月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/12/"><span class="level-start"><span class="level-item">十二月 2019</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/11/"><span class="level-start"><span class="level-item">十一月 2019</span></span><span class="level-end"><span class="level-item tag">19</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/10/"><span class="level-start"><span class="level-item">十月 2019</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/09/"><span class="level-start"><span class="level-item">九月 2019</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/08/"><span class="level-start"><span class="level-item">八月 2019</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/05/"><span class="level-start"><span class="level-item">五月 2019</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Assembly/"><span class="tag">Assembly</span><span class="tag">35</span></a></div><div class="control"><a class="tags has-addons" href="/tags/C/"><span class="tag">C++</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CTF/"><span class="tag">CTF</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CrackMe/"><span class="tag">CrackMe</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/HOOK/"><span class="tag">HOOK</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hacker/"><span class="tag">Hacker</span><span class="tag">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Reverse/"><span class="tag">Reverse</span><span class="tag">24</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Scoket/"><span class="tag">Scoket</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Windows-Kernel/"><span class="tag">Windows-Kernel</span><span class="tag">16</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Windows-PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97/"><span class="tag">Windows-PE权威指南</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Windows%E6%A0%B8%E5%BF%83%E7%BC%96%E7%A8%8B/"><span class="tag">Windows核心编程</span><span class="tag">17</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Windows%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/"><span class="tag">Windows程序设计</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/c/"><span class="tag">c</span><span class="tag">8</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">订阅更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="订阅"></div></div></form></div></div></div><div class="card widget"><div class="card-content"><div class="notification is-danger">You need to set <code>client_id</code> and <code>slot_id</code> to show this AD unit. Please set it in <code>_config.yml</code>.</div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/head.jpg" alt="sYstemk1t&#039;s blog" height="28"></a><p class="is-size-7"><span>&copy; 2020 sYstemk1t</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" async></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>