<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>PE权威指南 - PE文件头 - sYstemk1t&#039;s blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="sYstemk1t"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="sYstemk1t"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta description="PE头中记录了PE文件的所有数据的组织方式，通过PE文件头部分对某些数据结构描述，也可以定位不在文件头部的信息；"><meta property="og:type" content="blog"><meta property="og:title" content="PE权威指南 - PE文件头"><meta property="og:url" content="http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/"><meta property="og:site_name" content="sYstemk1t&#039;s blog"><meta property="og:description" content="PE头中记录了PE文件的所有数据的组织方式，通过PE文件头部分对某些数据结构描述，也可以定位不在文件头部的信息；"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/0.png"><meta property="og:image" content="http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/18.png"><meta property="og:image" content="http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/19.png"><meta property="og:image" content="http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/1.png"><meta property="og:image" content="http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/2.png"><meta property="og:image" content="http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/3.png"><meta property="og:image" content="http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/4.png"><meta property="og:image" content="http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/5.png"><meta property="og:image" content="http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/6.png"><meta property="og:image" content="http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/7.png"><meta property="og:image" content="http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/8.png"><meta property="og:image" content="http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/9.png"><meta property="og:image" content="http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/10.png"><meta property="og:image" content="http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/11.png"><meta property="og:image" content="http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/12.png"><meta property="og:image" content="http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/13.png"><meta property="og:image" content="http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/14.png"><meta property="og:image" content="http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/15.png"><meta property="og:image" content="http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/16.png"><meta property="og:image" content="http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/17.png"><meta property="article:published_time" content="2020-10-28T01:09:17.000Z"><meta property="article:modified_time" content="2020-11-05T04:13:15.710Z"><meta property="article:author" content="sYstemk1t"><meta property="article:tag" content="Windows-PE权威指南"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/0.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/"},"headline":"sYstemk1t's blog","image":["http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/0.png","http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/18.png","http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/19.png","http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/1.png","http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/2.png","http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/3.png","http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/4.png","http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/5.png","http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/6.png","http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/7.png","http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/8.png","http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/9.png","http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/10.png","http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/11.png","http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/12.png","http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/13.png","http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/14.png","http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/15.png","http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/16.png","http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/17.png"],"datePublished":"2020-10-28T01:09:17.000Z","dateModified":"2020-11-05T04:13:15.710Z","author":{"@type":"Person","name":"sYstemk1t"},"description":"PE头中记录了PE文件的所有数据的组织方式，通过PE文件头部分对某些数据结构描述，也可以定位不在文件头部的信息；"}</script><link rel="canonical" href="http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="fontawesome"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.2.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/head.jpg" alt="sYstemk1t&#039;s blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-10-28T01:09:17.000Z" title="2020-10-28T01:09:17.000Z">2020-10-28</time>发表</span><span class="level-item"><time dateTime="2020-11-05T04:13:15.710Z" title="2020-11-05T04:13:15.710Z">2020-11-05</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Windows-PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97/">Windows-PE权威指南</a></span><span class="level-item">31 分钟读完 (大约4657个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">PE权威指南 - PE文件头</h1><div class="content"><p>PE头中记录了PE文件的所有数据的组织方式，通过PE文件头部分对某些数据结构描述，也可以定位不在文件头部的信息；</p>
<a id="more"></a>





<h1 id="PE文件头"><a href="#PE文件头" class="headerlink" title="PE文件头"></a>PE文件头</h1><h2 id="文件头基本概念"><a href="#文件头基本概念" class="headerlink" title="文件头基本概念"></a>文件头基本概念</h2><p>在了解详细的PE头文件之前，需要了解几个基本的概念。</p>
<p><img src="/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/0.png"></p>
<p>PE文件整体结构：</p>
<p><img src="/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/18.png"></p>
<p><img src="/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/19.png"></p>
<h3 id="地址"><a href="#地址" class="headerlink" title="地址"></a>地址</h3><p>PE中的地址分为四类：</p>
<ul>
<li>虚拟内存地址(VA)<ul>
<li>PE文件相对应的进程支配了自己独立的4gb虚拟空间，在这个空间定位的地址是VA，VA的范围是4GB。VA计算方式：进程基地址+RVA</li>
</ul>
</li>
<li>相对虚拟内存地址(RVA)<ul>
<li>同时加载到进程空间的文件，一个进程同时需要加载动态链接库就是模块，每个模块都有一个基地址，而RVA是针对于模块的概念，用来定位某个特殊位置距离某个模块基地址的偏移量</li>
<li><img src="/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/1.png"></li>
</ul>
</li>
<li>文件偏移地址(FOA)<ul>
<li>与内存无关，它具体指某个位置距离文件头的偏移</li>
</ul>
</li>
<li>特殊地址</li>
</ul>
<h3 id="指针"><a href="#指针" class="headerlink" title="指针"></a>指针</h3><p><strong>PE数据结构中的指针的定义：从数据结构中某个字段存储的值为一个地址，那么这个字段就是一个指针；</strong></p>
<h3 id="数据目录"><a href="#数据目录" class="headerlink" title="数据目录"></a>数据目录</h3><p>PE文件中有一个数据结构为数据目录，其中记录了所有可能的数据类型，后续要学习的导入表等都存在于这个数据目录中；</p>
<h3 id="节"><a href="#节" class="headerlink" title="节"></a>节</h3><p>节是用于存放不同数据类型的地方，不同的节代表不同的访问权限。类似于内存中的内存四区；</p>
<h3 id="对齐"><a href="#对齐" class="headerlink" title="对齐"></a>对齐</h3><p>PE文件中规定了三类对齐：数据在内存中的对齐、数据在文件中的对齐、资源文件中资源数据的对齐；</p>
<ul>
<li><p>内存对齐</p>
<ul>
<li>Windows对内存属性设置以页为单位，对32位系统来说，这个值是4kb(1000h)，64位操作系统下，这个值是8kb(2000h)；</li>
</ul>
</li>
<li><p>文件对齐</p>
<ul>
<li>为了提高磁盘效率，通常以一个物理扇区的大小为对齐粒度，即512字节(200h)</li>
</ul>
</li>
<li><p>资源数据对齐</p>
<ul>
<li>资源字节码一般要求以双字(4字节)对齐</li>
</ul>
</li>
</ul>
<h2 id="PE文件格式"><a href="#PE文件格式" class="headerlink" title="PE文件格式"></a>PE文件格式</h2><h3 id="16位PE"><a href="#16位PE" class="headerlink" title="16位PE"></a>16位PE</h3><p>在16位系统中，PE文件大致可分为：DOS头和冗余数据。</p>
<p><img src="/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/2.png"></p>
<h4 id="DOS-MZ头"><a href="#DOS-MZ头" class="headerlink" title="DOS MZ头"></a>DOS MZ头</h4><p>Windows PE中，DOS MZ头的定义如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">IMAGE_DOS_HEADER STRUCT </span><br><span class="line"></span><br><span class="line">&#123; </span><br><span class="line">    +<span class="number">0</span>h 	WORD 	e_magic   <span class="comment">// Magic DOS signature MZ(4Dh 5Ah)     	EXE标志，“MZ”</span></span><br><span class="line">    +<span class="number">2</span>h 	WORD  	e_cblp  <span class="comment">// Bytes on last page of file    			最后(部分)页中的字节数			</span></span><br><span class="line">    +<span class="number">4</span>h 	WORD  	e_cp   <span class="comment">// Pages in file 							文件中全部和部分页数</span></span><br><span class="line">    +<span class="number">6</span>h 	WORD  	e_crlc   <span class="comment">// Relocations 							重定位表中的指针数</span></span><br><span class="line">    +<span class="number">8</span>h 	WORD  	e_cparhdr   <span class="comment">// Size of header in paragraphs 		头部尺寸，段落为单位</span></span><br><span class="line">    +<span class="number">0</span>ah 	WORD  	e_minalloc  <span class="comment">// Minimun extra paragraphs needs 		所需最小附加段</span></span><br><span class="line">    +<span class="number">0</span>ch 	WORD  	e_maxalloc  <span class="comment">// Maximun extra paragraphs needs 		所需最大附加段</span></span><br><span class="line">    +<span class="number">0</span>eh 	WORD  	e_ss    <span class="comment">// intial(relative)SS value      DOS代码的初始化堆栈SS </span></span><br><span class="line">    +<span class="number">10</span>h 	WORD  	e_sp    <span class="comment">// intial SP value                 DOS代码的初始化堆栈指针SP </span></span><br><span class="line">    +<span class="number">12</span>h 	WORD  	e_csum    <span class="comment">// Checksum 								校验码</span></span><br><span class="line">    +<span class="number">14</span>h 	WORD  	e_ip    <span class="comment">//    intial IP value                     DOS代码的初始化指令入口[指针IP] </span></span><br><span class="line">    +<span class="number">16</span>h 	WORD  	e_cs    <span class="comment">// intial(relative)CS value                    DOS代码的初始堆栈入口 </span></span><br><span class="line">    +<span class="number">18</span>h 	WORD 	e_lfarlc    <span class="comment">// File Address of relocation table 	重定位表的字节偏移量</span></span><br><span class="line">    +<span class="number">1</span>ah 	WORD  	e_ovno        <span class="comment">//    Overlay number 					覆盖号</span></span><br><span class="line">    +<span class="number">1</span>ch 	WORD  	e_res[<span class="number">4</span>]    <span class="comment">// Reserved words 						保留字</span></span><br><span class="line">    +<span class="number">24</span>h 	WORD  	e_oemid    <span class="comment">//    OEM identifier(for e_oeminfo) 		OEM标识符</span></span><br><span class="line">    +<span class="number">26</span>h 	WORD    e_oeminfo   <span class="comment">//    OEM information;e_oemid specific  OEM信息</span></span><br><span class="line">    +<span class="number">29</span>h 	WORD  	e_res2[<span class="number">10</span>]   <span class="comment">//    Reserved words 					保留字</span></span><br><span class="line">    +<span class="number">3</span>ch 	DWORD   e_lfanew     <span class="comment">// Offset to start of PE header             指向PE文件头 </span></span><br><span class="line">&#125; IMAGE_DOS_HEADER ENDS</span><br></pre></td></tr></table></figure>



<p><img src="/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/3.png"></p>
<h4 id="DOS-Stub"><a href="#DOS-Stub" class="headerlink" title="DOS Stub"></a>DOS Stub</h4><p>在exe中，DOS Stub字节码如下：</p>
<p><img src="/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/4.png"></p>
<p><strong>这部分是该程序在DOS下运行的指令字节码，我们可以在反汇编中查看</strong></p>
<p><img src="/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/5.png"></p>
<p>这段话的功能主要就是调用int 21号中断，在屏幕输出一段字符串。</p>
<h3 id="32位PE"><a href="#32位PE" class="headerlink" title="32位PE"></a>32位PE</h3><p>在32位系统中，DOS成为了冗余数据。在DOS中有一个字段规定了它必须写为”MZ”，即4D5A；</p>
<h4 id="定位PE头"><a href="#定位PE头" class="headerlink" title="定位PE头"></a>定位PE头</h4><p><strong>PE头 = 基地址 + IMAGE_DOS_HEADER.e_lfanew</strong></p>
<p>以我们的PE为例</p>
<p><img src="/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/6.png"></p>
<h4 id="PE结构"><a href="#PE结构" class="headerlink" title="PE结构"></a>PE结构</h4><p><img src="/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/7.png"></p>
<p>这样看PE就会觉得整个结构特别清晰，在32位下PE文件系统被划分为5个部分：</p>
<ul>
<li>DOS MZ头</li>
<li>DOS Stub</li>
<li>PE头</li>
<li>节表</li>
<li>节内容</li>
</ul>
<h4 id="PE结构解析"><a href="#PE结构解析" class="headerlink" title="PE结构解析"></a>PE结构解析</h4><p><img src="/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/8.png"></p>
<p>标准的PE文件由四大部分组成：</p>
<ul>
<li>DOS头</li>
<li>PE头(IMAGE_NT_HEADERS)</li>
<li>节表(多个IMAGE_SECTION_HEADER结构)</li>
<li>节内容</li>
</ul>
<p>PE头的数据结构最为复杂，包含：</p>
<ul>
<li>4字节的表示符号</li>
<li>20字节的基本头信息</li>
<li>216字节的扩展头信息</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_NT_HEADERS</span> &#123;</span></span><br><span class="line">    DWORD Signature;						<span class="comment">//4字节的表示符号</span></span><br><span class="line">    IMAGE_FILE_HEADER FileHeader;			<span class="comment">//20字节的基本头信息</span></span><br><span class="line">    IMAGE_OPTIONAL_HEADER32 OptionalHeader;	<span class="comment">//216字节的扩展头信息</span></span><br><span class="line">&#125; IMAGE_NT_HEADERS32, *PIMAGE_NT_HEADERS32;</span><br></pre></td></tr></table></figure>





<p><strong>PE文件头部 = DOS + PE头 + 节表</strong></p>
<p><strong>PE文件身体 = 节内容</strong></p>
<h2 id="PE头分析"><a href="#PE头分析" class="headerlink" title="PE头分析"></a>PE头分析</h2><h4 id="DOS头IMAGE-DOS-HEADER-64byte"><a href="#DOS头IMAGE-DOS-HEADER-64byte" class="headerlink" title="DOS头IMAGE_DOS_HEADER(64byte)"></a>DOS头IMAGE_DOS_HEADER(64byte)</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">IMAGE_DOS_HEADER STRUCT </span><br><span class="line">&#123; </span><br><span class="line">    +<span class="number">0</span>h 	WORD 	e_magic   <span class="comment">// Magic DOS signature MZ(4Dh 5Ah)     	EXE标志，“MZ”</span></span><br><span class="line">    +<span class="number">2</span>h 	WORD  	e_cblp  <span class="comment">// Bytes on last page of file    			最后(部分)页中的字节数			</span></span><br><span class="line">    +<span class="number">4</span>h 	WORD  	e_cp   <span class="comment">// Pages in file 							文件中全部和部分页数</span></span><br><span class="line">    +<span class="number">6</span>h 	WORD  	e_crlc   <span class="comment">// Relocations 							重定位表中的指针数</span></span><br><span class="line">    +<span class="number">8</span>h 	WORD  	e_cparhdr   <span class="comment">// Size of header in paragraphs 		头部尺寸，段落为单位</span></span><br><span class="line">    +<span class="number">0</span>ah 	WORD  	e_minalloc  <span class="comment">// Minimun extra paragraphs needs 		所需最小附加段</span></span><br><span class="line">    +<span class="number">0</span>ch 	WORD  	e_maxalloc  <span class="comment">// Maximun extra paragraphs needs 		所需最大附加段</span></span><br><span class="line">    +<span class="number">0</span>eh 	WORD  	e_ss    <span class="comment">// intial(relative)SS value      DOS代码的初始化堆栈SS </span></span><br><span class="line">    +<span class="number">10</span>h 	WORD  	e_sp    <span class="comment">// intial SP value                 DOS代码的初始化堆栈指针SP </span></span><br><span class="line">    +<span class="number">12</span>h 	WORD  	e_csum    <span class="comment">// Checksum 								校验码</span></span><br><span class="line">    +<span class="number">14</span>h 	WORD  	e_ip    <span class="comment">//    intial IP value                     DOS代码的初始化指令入口[指针IP] </span></span><br><span class="line">    +<span class="number">16</span>h 	WORD  	e_cs    <span class="comment">// intial(relative)CS value                    DOS代码的初始堆栈入口 </span></span><br><span class="line">    +<span class="number">18</span>h 	WORD 	e_lfarlc    <span class="comment">// File Address of relocation table 	重定位表的字节偏移量</span></span><br><span class="line">    +<span class="number">1</span>ah 	WORD  	e_ovno        <span class="comment">//    Overlay number 					覆盖号</span></span><br><span class="line">    +<span class="number">1</span>ch 	WORD  	e_res[<span class="number">4</span>]    <span class="comment">// Reserved words 						保留字</span></span><br><span class="line">    +<span class="number">24</span>h 	WORD  	e_oemid    <span class="comment">//    OEM identifier(for e_oeminfo) 		OEM标识符</span></span><br><span class="line">    +<span class="number">26</span>h 	WORD    e_oeminfo   <span class="comment">//    OEM information;e_oemid specific  OEM信息</span></span><br><span class="line">    +<span class="number">29</span>h 	WORD  	e_res2[<span class="number">10</span>]   <span class="comment">//    Reserved words 					保留字</span></span><br><span class="line">    +<span class="number">3</span>ch 	DWORD   e_lfanew     <span class="comment">// Offset to start of PE header             指向PE文件头 </span></span><br><span class="line">&#125; IMAGE_DOS_HEADER ENDS</span><br></pre></td></tr></table></figure>

<p>DOS MZ头的下面就是DOS Stub；</p>
<h4 id="PE头标识Signature-4byte"><a href="#PE头标识Signature-4byte" class="headerlink" title="PE头标识Signature(4byte)"></a>PE头标识Signature(4byte)</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_NT_HEADERS</span> &#123;</span></span><br><span class="line">    DWORD Signature;						<span class="comment">//4字节的表示符号</span></span><br><span class="line">    IMAGE_FILE_HEADER FileHeader;			<span class="comment">//20字节的基本头信息</span></span><br><span class="line">    IMAGE_OPTIONAL_HEADER32 OptionalHeader;	<span class="comment">//216字节的扩展头信息</span></span><br><span class="line">&#125; IMAGE_NT_HEADERS32, *PIMAGE_NT_HEADERS32;</span><br></pre></td></tr></table></figure>





<h4 id="标准PE头IMAGE-FILE-HEADER-20byte"><a href="#标准PE头IMAGE-FILE-HEADER-20byte" class="headerlink" title="标准PE头IMAGE_FILE_HEADER(20byte)"></a>标准PE头IMAGE_FILE_HEADER(20byte)</h4><p><strong>标准PE头位于PE头后，即位于IMAGE_DOS_HEADER的e_lfanew值+4的位置；</strong>此位置开始的20个字节位数据结构标准PE头IMAGE_FILE_HEADER的内容；</p>
<p>它记录了PE文件的全局属性；</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_FILE_HEADER</span> &#123;</span></span><br><span class="line">    WORD    Machine;							<span class="comment">//+04h，运行平台</span></span><br><span class="line">    WORD    NumberOfSections;					<span class="comment">//+06h，PE中节的数量</span></span><br><span class="line">    DWORD   TimeDateStamp;						<span class="comment">//+08h，文件创建日期和时间</span></span><br><span class="line">    DWORD   PointerToSymbolTable;				<span class="comment">//+0ch，指向符号表</span></span><br><span class="line">    DWORD   NumberOfSymbols;					<span class="comment">//+10h，符号表中的符号数量</span></span><br><span class="line">    WORD    SizeOfOptionalHeader;				<span class="comment">//+14h，扩展头结构的长度</span></span><br><span class="line">    WORD    Characteristics;					<span class="comment">//+16h，文件属性</span></span><br><span class="line">&#125; IMAGE_FILE_HEADER, *PIMAGE_FILE_HEADER;</span><br></pre></td></tr></table></figure>

<p><strong>该结构通常用于判断PE文件是EXE还是DLL，不但可以通过该结构获得PE文件中节的总数量，还可以当成对节区信息进行循环遍历时的循环计数</strong></p>
<h4 id="扩展PE头IMAGE-OPTIONAL-HEADER32-224byte"><a href="#扩展PE头IMAGE-OPTIONAL-HEADER32-224byte" class="headerlink" title="扩展PE头IMAGE_OPTIONAL_HEADER32(224byte)"></a>扩展PE头IMAGE_OPTIONAL_HEADER32(224byte)</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_OPTIONAL_HEADER</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="comment">// Standard fields.  </span></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    +<span class="number">18</span>h    WORD    Magic;                   <span class="comment">// 标志字, ROM 映像（0107h）,普通可执行文件（010Bh）</span></span><br><span class="line">    +<span class="number">1</span>Ah    BYTE    MajorLinkerVersion;      <span class="comment">// 链接程序的主版本号</span></span><br><span class="line">    +<span class="number">1B</span>h    BYTE    MinorLinkerVersion;      <span class="comment">// 链接程序的次版本号</span></span><br><span class="line">    +<span class="number">1</span>Ch    DWORD   SizeOfCode;              <span class="comment">// 所有含代码的节的总大小</span></span><br><span class="line">    +<span class="number">20</span>h    DWORD   SizeOfInitializedData;   <span class="comment">// 所有含已初始化数据的节的总大小</span></span><br><span class="line">    +<span class="number">24</span>h    DWORD   SizeOfUninitializedData; <span class="comment">// 所有含未初始化数据的节的大小</span></span><br><span class="line">    +<span class="number">28</span>h    DWORD   AddressOfEntryPoint;     <span class="comment">// 程序执行入口RVA</span></span><br><span class="line">    +<span class="number">2</span>Ch    DWORD   BaseOfCode;              <span class="comment">// 代码的区块的起始RVA</span></span><br><span class="line">    +<span class="number">30</span>h    DWORD   BaseOfData;              <span class="comment">// 数据的区块的起始RVA</span></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="comment">// NT additional fields.    以下是属于NT结构增加的领域。</span></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    +<span class="number">34</span>h    DWORD   ImageBase;               <span class="comment">// 程序的首选装载地址</span></span><br><span class="line">    +<span class="number">38</span>h    DWORD   SectionAlignment;        <span class="comment">// 内存中的区块的对齐大小</span></span><br><span class="line">    +<span class="number">3</span>Ch    DWORD   FileAlignment;           <span class="comment">// 文件中的区块的对齐大小</span></span><br><span class="line">    +<span class="number">40</span>h    WORD    MajorOperatingSystemVersion;  <span class="comment">// 要求操作系统最低版本号的主版本号</span></span><br><span class="line">    +<span class="number">42</span>h    WORD    MinorOperatingSystemVersion;  <span class="comment">// 要求操作系统最低版本号的副版本号</span></span><br><span class="line">    +<span class="number">44</span>h    WORD    MajorImageVersion;       <span class="comment">// 可运行于操作系统的主版本号</span></span><br><span class="line">    +<span class="number">46</span>h    WORD    MinorImageVersion;       <span class="comment">// 可运行于操作系统的次版本号</span></span><br><span class="line">    +<span class="number">48</span>h    WORD    MajorSubsystemVersion;   <span class="comment">// 要求最低子系统版本的主版本号</span></span><br><span class="line">    +<span class="number">4</span>Ah    WORD    MinorSubsystemVersion;   <span class="comment">// 要求最低子系统版本的次版本号</span></span><br><span class="line">    +<span class="number">4</span>Ch    DWORD   Win32VersionValue;       <span class="comment">// 莫须有字段，不被病毒利用的话一般为0</span></span><br><span class="line">    +<span class="number">50</span>h    DWORD   SizeOfImage;             <span class="comment">// 映像装入内存后的总尺寸</span></span><br><span class="line">    +<span class="number">54</span>h    DWORD   SizeOfHeaders;           <span class="comment">// 所有头 + 区块表的尺寸大小</span></span><br><span class="line">    +<span class="number">58</span>h    DWORD   CheckSum;                <span class="comment">// 映像的校检和</span></span><br><span class="line">    +<span class="number">5</span>Ch    WORD    Subsystem;               <span class="comment">// 可执行文件期望的子系统</span></span><br><span class="line">    +<span class="number">5</span>Eh    WORD    DllCharacteristics;      <span class="comment">// DllMain()函数何时被调用，默认为 0</span></span><br><span class="line">    +<span class="number">60</span>h    DWORD   SizeOfStackReserve;      <span class="comment">// 初始化时的栈大小</span></span><br><span class="line">    +<span class="number">64</span>h    DWORD   SizeOfStackCommit;       <span class="comment">// 初始化时实际提交的栈大小</span></span><br><span class="line">    +<span class="number">68</span>h    DWORD   SizeOfHeapReserve;       <span class="comment">// 初始化时保留的堆大小</span></span><br><span class="line">    +<span class="number">6</span>Ch    DWORD   SizeOfHeapCommit;        <span class="comment">// 初始化时实际提交的堆大小</span></span><br><span class="line">    +<span class="number">70</span>h    DWORD   LoaderFlags;             <span class="comment">// 与调试有关，默认为 0 </span></span><br><span class="line">    +<span class="number">74</span>h    DWORD   NumberOfRvaAndSizes;     <span class="comment">// 下边数据目录的项数，这个字段自Windows NT 发布以来一直是16</span></span><br><span class="line">    +<span class="number">78</span>h    IMAGE_DATA_DIRECTORY DataDirectory[IMAGE_NUMBEROF_DIRECTORY_ENTRIES];   </span><br><span class="line">    <span class="comment">// 数据目录表</span></span><br><span class="line">&#125; IMAGE_OPTIONAL_HEADER32, *PIMAGE_OPTIONAL_HEADER32;</span><br></pre></td></tr></table></figure>

<p><strong>文件执行时的入口地址、文件被操作系统装载进入内存后的默认基地址 ，以及节在磁盘和内存中的对齐单位等信息均可以在此结构中找到。</strong></p>
<h4 id="PE头IMAGE-NT-HEADERS"><a href="#PE头IMAGE-NT-HEADERS" class="headerlink" title="PE头IMAGE_NT_HEADERS"></a>PE头IMAGE_NT_HEADERS</h4><p>这个PE头是广义上的PE头，标准PE文件中其大小为456个字节。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_NT_HEADERS</span> &#123;</span>       </span><br><span class="line">	DWORD Signature;                              <span class="comment">//位置在e_lfanew上</span></span><br><span class="line">	IMAGE_FILE_HEADER FileHeader;				  <span class="comment">//e_lfanew + 0x4         文件头结构体</span></span><br><span class="line">	IMAGE_OPTIONAL_HEADER32 OptionalHeader;       <span class="comment">//e_lfanew + 0x18        可选头结构体</span></span><br><span class="line">&#125; IMAGE_NT_HEADERS32, *PIMAGE_NT_HEADERS32;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/9.png"></p>
<h4 id="数据目录项IMAGE-DATA-DIRECTORY"><a href="#数据目录项IMAGE-DATA-DIRECTORY" class="headerlink" title="数据目录项IMAGE_DATA_DIRECTORY"></a>数据目录项IMAGE_DATA_DIRECTORY</h4><p>IMAGE_OPTIONAL_HEADER32结构最后一个字段为DataDirectory。该字段中定义了PE文件中出现所有不同类型的数据的目录信息。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_DATA_DIRECTORY</span> &#123;</span></span><br><span class="line">  DWORD VirtualAddress;                   <span class="comment">/**指向某个数据的相对虚拟地址   RAV  偏移0x00**/</span></span><br><span class="line">  DWORD Size;                             <span class="comment">/**某个数据块的大小                 偏移0x04**/</span></span><br><span class="line">&#125; IMAGE_DATA_DIRECTORY, *PIMAGE_DATA_DIRECTORY;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/10.png"></p>
<p>这16个数组每一项都代表PE中的某一个类型的数据：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_EXPORT    0			<span class="comment">//导入表地址和大小</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_IMPORT    1			<span class="comment">//导出表地址和大小</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_RESOURCE  2			<span class="comment">//资源表地址和大小</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_EXCEPTION 3			<span class="comment">//异常表地址和大小</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_SECURITY  4			<span class="comment">//属性证书数据地址和大小</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_BASERELOC 5			<span class="comment">//基地址重定位表和大小</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_DEBUG 6				<span class="comment">//调试信息地址和大小</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_COPYRIGHT 7			<span class="comment">//预留为0</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_ARCHITECTURE  7		<span class="comment">//预留为0</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_GLOBALPTR 8			<span class="comment">//指向全局指针寄存器的值</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_TLS   9				<span class="comment">//线程局部存储地址和大小</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_LOAD_CONFIG   10		<span class="comment">//加载配置表地址和大小</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_BOUND_IMPORT  11		<span class="comment">//绑定导入标地址和大小</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_IAT   12				<span class="comment">//导入函数地址标和大小</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_DELAY_IMPORT  13		<span class="comment">//延迟导入表地址和大小</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IMAGE_DIRECTORY_ENTRY_COM_DESCRIPTOR    14		<span class="comment">//CLR运行时头部数据地址和大小</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Reserved	15								<span class="comment">//保留</span></span></span><br></pre></td></tr></table></figure>







<h4 id="节表项IMAGE-SECTION-HEADER"><a href="#节表项IMAGE-SECTION-HEADER" class="headerlink" title="节表项IMAGE_SECTION_HEADER"></a>节表项IMAGE_SECTION_HEADER</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_SECTION_HEADER</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    +<span class="number">0</span>h BYTE Name[IMAGE_SIZEOF_SHORT_NAME]; <span class="comment">// 节表名称,如“.text” </span></span><br><span class="line">    <span class="comment">//IMAGE_SIZEOF_SHORT_NAME=8</span></span><br><span class="line">    <span class="keyword">union</span></span><br><span class="line">    +<span class="number">8</span>h &#123;</span><br><span class="line">    DWORD PhysicalAddress; <span class="comment">// 物理地址</span></span><br><span class="line">    DWORD VirtualSize; <span class="comment">// 真实长度，这两个值是一个联合结构，可以使用其中的任何一个，一</span></span><br><span class="line">    <span class="comment">// 般是取后一个</span></span><br><span class="line">    &#125; Misc;</span><br><span class="line">    +ch DWORD VirtualAddress; <span class="comment">// 节区的 RVA 地址</span></span><br><span class="line">    +<span class="number">10</span>h DWORD SizeOfRawData; <span class="comment">// 在文件中对齐后的尺寸</span></span><br><span class="line">    +<span class="number">14</span>h DWORD PointerToRawData; <span class="comment">// 在文件中的偏移量</span></span><br><span class="line">    +<span class="number">18</span>h DWORD PointerToRelocations; <span class="comment">// 在OBJ文件中使用，重定位的偏移</span></span><br><span class="line">    +<span class="number">1</span>ch DWORD PointerToLinenumbers; <span class="comment">// 行号表的偏移（供调试使用地）</span></span><br><span class="line">    +<span class="number">1</span>eh WORD NumberOfRelocations; <span class="comment">// 在OBJ文件中使用，重定位项数目</span></span><br><span class="line">    +<span class="number">20</span>h WORD NumberOfLinenumbers; <span class="comment">// 行号表中行号的数目</span></span><br><span class="line">    +<span class="number">24</span>h DWORD Characteristics; <span class="comment">// 节属性如可读，可写，可执行等&#125; </span></span><br><span class="line">IMAGE_SECTION_HEADER, *PIMAGE_SECTION_HEADER;</span><br></pre></td></tr></table></figure>







<h2 id="数据结构字段详解"><a href="#数据结构字段详解" class="headerlink" title="数据结构字段详解"></a>数据结构字段详解</h2><h3 id="PE头IMAGE-NT-HEADERS32"><a href="#PE头IMAGE-NT-HEADERS32" class="headerlink" title="PE头IMAGE_NT_HEADERS32"></a>PE头IMAGE_NT_HEADERS32</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_NT_HEADERS</span> &#123;</span></span><br><span class="line">    DWORD Signature;</span><br><span class="line">    IMAGE_FILE_HEADER FileHeader;</span><br><span class="line">    IMAGE_OPTIONAL_HEADER32 OptionalHeader;</span><br><span class="line">&#125; IMAGE_NT_HEADERS32, *PIMAGE_NT_HEADERS32;</span><br></pre></td></tr></table></figure>

<h4 id="IMAGE-NT-HEADERS32-Signature"><a href="#IMAGE-NT-HEADERS32-Signature" class="headerlink" title="IMAGE_NT_HEADERS32.Signature"></a>IMAGE_NT_HEADERS32.Signature</h4><p>+0000h</p>
<p>PE文件标识，被定义为00004550h。也就是”P”、”E”加两个0。</p>
<h4 id="IMAGE-NT-HEADERS32-FileHeader"><a href="#IMAGE-NT-HEADERS32-FileHeader" class="headerlink" title="IMAGE_NT_HEADERS32.FileHeader"></a>IMAGE_NT_HEADERS32.FileHeader</h4><p>+0004h</p>
<p>指向IMAGE_FILE_HEADER，被称为标准COFF头</p>
<h4 id="IMAGE-NT-HEADERS32-OptionalHeader"><a href="#IMAGE-NT-HEADERS32-OptionalHeader" class="headerlink" title="IMAGE_NT_HEADERS32.OptionalHeader"></a>IMAGE_NT_HEADERS32.OptionalHeader</h4><p>+0018h</p>
<p>指向IMAGE_OPTIONAL_HEADER32，Windows操作系统可执行文件的大部分特性在这个结构中体现。</p>
<h3 id="标准PE头IMAGE-FILE-HEADER"><a href="#标准PE头IMAGE-FILE-HEADER" class="headerlink" title="标准PE头IMAGE_FILE_HEADER"></a>标准PE头IMAGE_FILE_HEADER</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_FILE_HEADER</span> &#123;</span></span><br><span class="line">    WORD    Machine;</span><br><span class="line">    WORD    NumberOfSections;</span><br><span class="line">    DWORD   TimeDateStamp;</span><br><span class="line">    DWORD   PointerToSymbolTable;</span><br><span class="line">    DWORD   NumberOfSymbols;</span><br><span class="line">    WORD    SizeOfOptionalHeader;</span><br><span class="line">    WORD    Characteristics;</span><br><span class="line">&#125; IMAGE_FILE_HEADER, *PIMAGE_FILE_HEADER;</span><br></pre></td></tr></table></figure>



<h4 id="IMAGE-FILE-HEADER-Machine"><a href="#IMAGE-FILE-HEADER-Machine" class="headerlink" title="IMAGE_FILE_HEADER.Machine"></a>IMAGE_FILE_HEADER.Machine</h4><p>+0004h</p>
<p>用于指定PE文件运行的平台。</p>
<h4 id="IMAGE-FILE-HEADER-NumberOfSections"><a href="#IMAGE-FILE-HEADER-NumberOfSections" class="headerlink" title="IMAGE_FILE_HEADER.NumberOfSections"></a>IMAGE_FILE_HEADER.NumberOfSections</h4><p>+0006h</p>
<p>文件中存在节的总数。这个值不能小于1也不可以超过96，但是在Windows xp中可以存在0个节。</p>
<h4 id="IMAGE-FILE-HEADER-TimeDateStamp"><a href="#IMAGE-FILE-HEADER-TimeDateStamp" class="headerlink" title="IMAGE_FILE_HEADER.TimeDateStamp"></a>IMAGE_FILE_HEADER.TimeDateStamp</h4><p>+0008h</p>
<p>文件创建的时间戳，低32位存放的值是自1970年1月1日0：0时开始到创建文件时的总秒数。</p>
<h4 id="IMAGE-FILE-HEADER-PointerToSymbolTable"><a href="#IMAGE-FILE-HEADER-PointerToSymbolTable" class="headerlink" title="IMAGE_FILE_HEADER.PointerToSymbolTable"></a>IMAGE_FILE_HEADER.PointerToSymbolTable</h4><p>+000ch</p>
<p>coff符号表的文件偏移，如果不存在coff符号表，此值为0</p>
<h4 id="IMAGE-FILE-HEADER-NumberOfSymbols"><a href="#IMAGE-FILE-HEADER-NumberOfSymbols" class="headerlink" title="IMAGE_FILE_HEADER.NumberOfSymbols"></a>IMAGE_FILE_HEADER.NumberOfSymbols</h4><p>+0010h</p>
<p>符号标中元素的数目。由于字符表紧跟在符号表后，所以可以利用这个值定位字符串表。对于映像文件来说，此值为0，用于调试。</p>
<h4 id="IMAGE-FILE-HEADER-SizeOfOptionalHeader"><a href="#IMAGE-FILE-HEADER-SizeOfOptionalHeader" class="headerlink" title="IMAGE_FILE_HEADER.SizeOfOptionalHeader"></a>IMAGE_FILE_HEADER.SizeOfOptionalHeader</h4><p>+0014h</p>
<p><strong>指向IMAGE_OPTIONAL_HEADER32的长度，32位下默认情况下长度为00e0h。64位下默认为00f0h</strong></p>
<h4 id="IMAGE-FILE-HEADER-Characteristics"><a href="#IMAGE-FILE-HEADER-Characteristics" class="headerlink" title="IMAGE_FILE_HEADER.Characteristics"></a>IMAGE_FILE_HEADER.Characteristics</h4><p>+0016h</p>
<p>文件属性标志字段，它的不同数据为定义了不同的文件属性。</p>
<h3 id="扩展PE头IMAGE-OPTIONAL-HEADER32"><a href="#扩展PE头IMAGE-OPTIONAL-HEADER32" class="headerlink" title="扩展PE头IMAGE_OPTIONAL_HEADER32"></a>扩展PE头IMAGE_OPTIONAL_HEADER32</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_OPTIONAL_HEADER</span> &#123;</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// Standard fields.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">    WORD    Magic;</span><br><span class="line">    BYTE    MajorLinkerVersion;</span><br><span class="line">    BYTE    MinorLinkerVersion;</span><br><span class="line">    DWORD   SizeOfCode;</span><br><span class="line">    DWORD   SizeOfInitializedData;</span><br><span class="line">    DWORD   SizeOfUninitializedData;</span><br><span class="line">    DWORD   AddressOfEntryPoint;</span><br><span class="line">    DWORD   BaseOfCode;</span><br><span class="line">    DWORD   BaseOfData;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// NT additional fields.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">    DWORD   ImageBase;</span><br><span class="line">    DWORD   SectionAlignment;</span><br><span class="line">    DWORD   FileAlignment;</span><br><span class="line">    WORD    MajorOperatingSystemVersion;</span><br><span class="line">    WORD    MinorOperatingSystemVersion;</span><br><span class="line">    WORD    MajorImageVersion;</span><br><span class="line">    WORD    MinorImageVersion;</span><br><span class="line">    WORD    MajorSubsystemVersion;</span><br><span class="line">    WORD    MinorSubsystemVersion;</span><br><span class="line">    DWORD   Win32VersionValue;</span><br><span class="line">    DWORD   SizeOfImage;</span><br><span class="line">    DWORD   SizeOfHeaders;</span><br><span class="line">    DWORD   CheckSum;</span><br><span class="line">    WORD    Subsystem;</span><br><span class="line">    WORD    DllCharacteristics;</span><br><span class="line">    DWORD   SizeOfStackReserve;</span><br><span class="line">    DWORD   SizeOfStackCommit;</span><br><span class="line">    DWORD   SizeOfHeapReserve;</span><br><span class="line">    DWORD   SizeOfHeapCommit;</span><br><span class="line">    DWORD   LoaderFlags;</span><br><span class="line">    DWORD   NumberOfRvaAndSizes;</span><br><span class="line">    IMAGE_DATA_DIRECTORY DataDirectory[IMAGE_NUMBEROF_DIRECTORY_ENTRIES];</span><br><span class="line">&#125; IMAGE_OPTIONAL_HEADER32, *PIMAGE_OPTIONAL_HEADER32;</span><br></pre></td></tr></table></figure>







<h4 id="IMAGE-OPTIONAL-HEADER32-Magic"><a href="#IMAGE-OPTIONAL-HEADER32-Magic" class="headerlink" title="IMAGE_OPTIONAL_HEADER32.Magic"></a>IMAGE_OPTIONAL_HEADER32.Magic</h4><p>+0018h</p>
<p>说明文件类型：</p>
<ul>
<li>010BH为PE32</li>
<li>0107H为ROM映像</li>
<li>020BH为PE32+(64位)</li>
</ul>
<h4 id="IMAGE-OPTIONAL-HEADER32-MajorLinkerVersion"><a href="#IMAGE-OPTIONAL-HEADER32-MajorLinkerVersion" class="headerlink" title="IMAGE_OPTIONAL_HEADER32.MajorLinkerVersion"></a>IMAGE_OPTIONAL_HEADER32.MajorLinkerVersion</h4><p>+001ah</p>
<p>链接器版本</p>
<h4 id="IMAGE-OPTIONAL-HEADER32-SizeOfCode"><a href="#IMAGE-OPTIONAL-HEADER32-SizeOfCode" class="headerlink" title="IMAGE_OPTIONAL_HEADER32.SizeOfCode"></a>IMAGE_OPTIONAL_HEADER32.SizeOfCode</h4><p>+001ch</p>
<p>所有代码节的综合，该大小是基于文件对齐后的大小，而不是内存对齐后的大小</p>
<h4 id><a href="#" class="headerlink" title></a></h4><h4 id="IMAGE-OPTIONAL-HEADER32-SizeOfInitializedData"><a href="#IMAGE-OPTIONAL-HEADER32-SizeOfInitializedData" class="headerlink" title="IMAGE_OPTIONAL_HEADER32.SizeOfInitializedData"></a>IMAGE_OPTIONAL_HEADER32.SizeOfInitializedData</h4><p>+0020h</p>
<p>包含初始化的数据的节的总大小</p>
<h4 id="IMAGE-OPTIONAL-HEADER32-SizeOfUninitializedData"><a href="#IMAGE-OPTIONAL-HEADER32-SizeOfUninitializedData" class="headerlink" title="IMAGE_OPTIONAL_HEADER32.SizeOfUninitializedData"></a>IMAGE_OPTIONAL_HEADER32.SizeOfUninitializedData</h4><p>+0024h</p>
<p>未初始化数据的节的总大小。</p>
<h4 id="IMAGE-OPTIONAL-HEADER32-AddressOfEntryPoint"><a href="#IMAGE-OPTIONAL-HEADER32-AddressOfEntryPoint" class="headerlink" title="IMAGE_OPTIONAL_HEADER32.AddressOfEntryPoint"></a>IMAGE_OPTIONAL_HEADER32.AddressOfEntryPoint</h4><p>+0028h</p>
<p>这个字段是一个RVA，它记录了启动代码距离该PE加载后的位置差多少个字符</p>
<h4 id="IMAGE-OPTIONAL-HEADER32-BaseOfCode"><a href="#IMAGE-OPTIONAL-HEADER32-BaseOfCode" class="headerlink" title="IMAGE_OPTIONAL_HEADER32.BaseOfCode"></a>IMAGE_OPTIONAL_HEADER32.BaseOfCode</h4><p>+002ch</p>
<p>代码节起始的RVA，表示映像被加载进内存时代码节的开头相对于映像基址的偏移地址。</p>
<h4 id="IMAGE-OPTIONAL-HEADER32-BaseOfData"><a href="#IMAGE-OPTIONAL-HEADER32-BaseOfData" class="headerlink" title="IMAGE_OPTIONAL_HEADER32.BaseOfData"></a>IMAGE_OPTIONAL_HEADER32.BaseOfData</h4><p>+0030h</p>
<p>数据节其实RVA，表示映像被加载进内存时数据节的开头相对于映像基地址的偏移地址。</p>
<h4 id="IMAGE-OPTIONAL-HEADER32-BaseOfData-ImageBase"><a href="#IMAGE-OPTIONAL-HEADER32-BaseOfData-ImageBase" class="headerlink" title="IMAGE_OPTIONAL_HEADER32.BaseOfData.ImageBase"></a>IMAGE_OPTIONAL_HEADER32.BaseOfData.ImageBase</h4><p>+0034h</p>
<p>该字段指出PE映像优先装入地址。</p>
<h4 id="IMAGE-OPTIONAL-HEADER32-SectionAlignment"><a href="#IMAGE-OPTIONAL-HEADER32-SectionAlignment" class="headerlink" title="IMAGE_OPTIONAL_HEADER32.SectionAlignment"></a>IMAGE_OPTIONAL_HEADER32.SectionAlignment</h4><p>+0038h</p>
<p>内存对齐粒度，该字段指定了节被装入内存后的对齐单位</p>
<h4 id="IMAGE-OPTIONAL-HEADER32-FileAlignment"><a href="#IMAGE-OPTIONAL-HEADER32-FileAlignment" class="headerlink" title="IMAGE_OPTIONAL_HEADER32.FileAlignment"></a>IMAGE_OPTIONAL_HEADER32.FileAlignment</h4><p>+003ch</p>
<p>文件中节的对齐粒度。</p>
<h4 id="IMAGE-OPTIONAL-HEADER32-MajorOperatingSystemVersion"><a href="#IMAGE-OPTIONAL-HEADER32-MajorOperatingSystemVersion" class="headerlink" title="IMAGE_OPTIONAL_HEADER32.MajorOperatingSystemVersion"></a>IMAGE_OPTIONAL_HEADER32.MajorOperatingSystemVersion</h4><p>+0040h</p>
<p>标识操作系统的版本号，分为主版本号和次版本号</p>
<h4 id="IMAGE-OPTIONAL-HEADER32-MajorImageVersion"><a href="#IMAGE-OPTIONAL-HEADER32-MajorImageVersion" class="headerlink" title="IMAGE_OPTIONAL_HEADER32.MajorImageVersion"></a>IMAGE_OPTIONAL_HEADER32.MajorImageVersion</h4><p>+0044h</p>
<p>本PE文件的映像版本号</p>
<h4 id="IMAGE-OPTIONAL-HEADER32-MajorSubsystemVersion"><a href="#IMAGE-OPTIONAL-HEADER32-MajorSubsystemVersion" class="headerlink" title="IMAGE_OPTIONAL_HEADER32.MajorSubsystemVersion"></a>IMAGE_OPTIONAL_HEADER32.MajorSubsystemVersion</h4><p>+0048h</p>
<p>运行所需要的子系统的版本号</p>
<h4 id="IMAGE-OPTIONAL-HEADER32-Win32VersionValue"><a href="#IMAGE-OPTIONAL-HEADER32-Win32VersionValue" class="headerlink" title="IMAGE_OPTIONAL_HEADER32.Win32VersionValue"></a>IMAGE_OPTIONAL_HEADER32.Win32VersionValue</h4><p>+004ch</p>
<p><strong>子系统版本的值，暂时保留，必须设置为0</strong></p>
<h4 id="IMAGE-OPTIONAL-HEADER32-SizeOfImage"><a href="#IMAGE-OPTIONAL-HEADER32-SizeOfImage" class="headerlink" title="IMAGE_OPTIONAL_HEADER32.SizeOfImage"></a>IMAGE_OPTIONAL_HEADER32.SizeOfImage</h4><p>+0050h</p>
<p>内存中整个PE文件的映射尺寸。</p>
<h4 id="IMAGE-OPTIONAL-HEADER32-SizeOfHeaders"><a href="#IMAGE-OPTIONAL-HEADER32-SizeOfHeaders" class="headerlink" title="IMAGE_OPTIONAL_HEADER32.SizeOfHeaders"></a>IMAGE_OPTIONAL_HEADER32.SizeOfHeaders</h4><p>+0054h</p>
<p>所有头+节表按照文件对齐粒度对齐后的大小</p>
<h4 id="IMAGE-OPTIONAL-HEADER32-CheckSum"><a href="#IMAGE-OPTIONAL-HEADER32-CheckSum" class="headerlink" title="IMAGE_OPTIONAL_HEADER32.CheckSum"></a>IMAGE_OPTIONAL_HEADER32.CheckSum</h4><p>+0058h</p>
<p>校验和</p>
<h4 id="IMAGE-OPTIONAL-HEADER32-Subsystem"><a href="#IMAGE-OPTIONAL-HEADER32-Subsystem" class="headerlink" title="IMAGE_OPTIONAL_HEADER32.Subsystem"></a>IMAGE_OPTIONAL_HEADER32.Subsystem</h4><p>+005ch</p>
<p>指定使用界面的子系统</p>
<h4 id="IMAGE-OPTIONAL-HEADER32-DllCharacteristics"><a href="#IMAGE-OPTIONAL-HEADER32-DllCharacteristics" class="headerlink" title="IMAGE_OPTIONAL_HEADER32.DllCharacteristics"></a>IMAGE_OPTIONAL_HEADER32.DllCharacteristics</h4><p>+005eh</p>
<p>DLL文件属性</p>
<h4 id="IMAGE-OPTIONAL-HEADER32-SizeOfStackReserve"><a href="#IMAGE-OPTIONAL-HEADER32-SizeOfStackReserve" class="headerlink" title="IMAGE_OPTIONAL_HEADER32.SizeOfStackReserve"></a>IMAGE_OPTIONAL_HEADER32.SizeOfStackReserve</h4><p>+0060h</p>
<p>初始化时保留栈大小</p>
<h4 id="IMAGE-OPTIONAL-HEADER32-SizeOfStackCommit"><a href="#IMAGE-OPTIONAL-HEADER32-SizeOfStackCommit" class="headerlink" title="IMAGE_OPTIONAL_HEADER32.SizeOfStackCommit"></a>IMAGE_OPTIONAL_HEADER32.SizeOfStackCommit</h4><p>+0064h</p>
<p>初始化时实际提交的栈大小</p>
<h4 id="IMAGE-OPTIONAL-HEADER32-SizeOfHeapReserve"><a href="#IMAGE-OPTIONAL-HEADER32-SizeOfHeapReserve" class="headerlink" title="IMAGE_OPTIONAL_HEADER32.SizeOfHeapReserve"></a>IMAGE_OPTIONAL_HEADER32.SizeOfHeapReserve</h4><p>+0068h</p>
<p>初始化时保留的堆大小</p>
<h4 id="IMAGE-OPTIONAL-HEADER32-SizeOfHeapCommit"><a href="#IMAGE-OPTIONAL-HEADER32-SizeOfHeapCommit" class="headerlink" title="IMAGE_OPTIONAL_HEADER32.SizeOfHeapCommit"></a>IMAGE_OPTIONAL_HEADER32.SizeOfHeapCommit</h4><p>+006ch</p>
<p>初始化时实际提交的堆大小</p>
<h4 id="IMAGE-OPTIONAL-HEADER32-LoaderFlags"><a href="#IMAGE-OPTIONAL-HEADER32-LoaderFlags" class="headerlink" title="IMAGE_OPTIONAL_HEADER32.LoaderFlags"></a>IMAGE_OPTIONAL_HEADER32.LoaderFlags</h4><p>+0070h</p>
<p>加载标志</p>
<h4 id="IMAGE-OPTIONAL-HEADER32-NumberOfRvaAndSizes"><a href="#IMAGE-OPTIONAL-HEADER32-NumberOfRvaAndSizes" class="headerlink" title="IMAGE_OPTIONAL_HEADER32.NumberOfRvaAndSizes"></a>IMAGE_OPTIONAL_HEADER32.NumberOfRvaAndSizes</h4><p>+0074h</p>
<p>定义数据目录结构的数量</p>
<h4 id="IMAGE-OPTIONAL-HEADER32-DataDirectory"><a href="#IMAGE-OPTIONAL-HEADER32-DataDirectory" class="headerlink" title="IMAGE_OPTIONAL_HEADER32.DataDirectory"></a>IMAGE_OPTIONAL_HEADER32.DataDirectory</h4><p>+0078h</p>
<p>由16个IMAGE）DIRECTORY结构线性组合而成，用于定义PE中的16中不同类型的数据所在位置和大小</p>
<h3 id="数据目录项IMAGE-DATA-DIRECTORY-1"><a href="#数据目录项IMAGE-DATA-DIRECTORY-1" class="headerlink" title="数据目录项IMAGE_DATA_DIRECTORY"></a>数据目录项IMAGE_DATA_DIRECTORY</h3><h4 id="IMAGE-DATA-DIRECTORY-VirtualAddress"><a href="#IMAGE-DATA-DIRECTORY-VirtualAddress" class="headerlink" title="IMAGE_DATA_DIRECTORY.VirtualAddress"></a>IMAGE_DATA_DIRECTORY.VirtualAddress</h4><p>+0000h</p>
<p>记录特定类型数据的起始RVA</p>
<h4 id="IMAGE-DATA-DIRECTORY-Size"><a href="#IMAGE-DATA-DIRECTORY-Size" class="headerlink" title="IMAGE_DATA_DIRECTORY.Size"></a>IMAGE_DATA_DIRECTORY.Size</h4><p>+0004h</p>
<p>特定类型的数据块长度</p>
<h3 id="节表项IMAGE-SECTION-HEADER-1"><a href="#节表项IMAGE-SECTION-HEADER-1" class="headerlink" title="节表项IMAGE_SECTION_HEADER"></a>节表项IMAGE_SECTION_HEADER</h3><h4 id="IMAGE-SECTION-HEADER-Name"><a href="#IMAGE-SECTION-HEADER-Name" class="headerlink" title="IMAGE_SECTION_HEADER.Name"></a>IMAGE_SECTION_HEADER.Name</h4><p>+0000h</p>
<p>共8个字节，一般是以”\0”结尾的ASCII码字符串定义。</p>
<h4 id="IMAGE-SECTION-HEADER-Misc"><a href="#IMAGE-SECTION-HEADER-Misc" class="headerlink" title="IMAGE_SECTION_HEADER.Misc"></a>IMAGE_SECTION_HEADER.Misc</h4><p>+0008h</p>
<p>union类型的数据，这是节的数据在没有对齐前的真实尺寸，通常不准确。</p>
<h4 id="IMAGE-SECTION-HEADER-VirtualAddress"><a href="#IMAGE-SECTION-HEADER-VirtualAddress" class="headerlink" title="IMAGE_SECTION_HEADER.VirtualAddress"></a>IMAGE_SECTION_HEADER.VirtualAddress</h4><p>+000ch</p>
<p>节区的RVA地址</p>
<h4 id="IMAGE-SECTION-HEADER-SizeOfRawData"><a href="#IMAGE-SECTION-HEADER-SizeOfRawData" class="headerlink" title="IMAGE_SECTION_HEADER.SizeOfRawData"></a>IMAGE_SECTION_HEADER.SizeOfRawData</h4><p>+0010h</p>
<p>节在文件中对齐后的尺寸</p>
<h4 id="IMAGE-SECTION-HEADER-PointerToRawData"><a href="#IMAGE-SECTION-HEADER-PointerToRawData" class="headerlink" title="IMAGE_SECTION_HEADER.PointerToRawData"></a>IMAGE_SECTION_HEADER.PointerToRawData</h4><p>+0014h</p>
<p>节区起始数据在文件中的偏移</p>
<h4 id="IMAGE-SECTION-HEADER-PointerToRelocations"><a href="#IMAGE-SECTION-HEADER-PointerToRelocations" class="headerlink" title="IMAGE_SECTION_HEADER.PointerToRelocations"></a>IMAGE_SECTION_HEADER.PointerToRelocations</h4><p>+0018h</p>
<p>在”.obj”文件中使用，指向重定位表的指针</p>
<h4 id="IMAGE-SECTION-HEADER-PointerToLinenumbers"><a href="#IMAGE-SECTION-HEADER-PointerToLinenumbers" class="headerlink" title="IMAGE_SECTION_HEADER.PointerToLinenumbers"></a>IMAGE_SECTION_HEADER.PointerToLinenumbers</h4><p>+001ch</p>
<p>行号表的位置</p>
<h4 id="IMAGE-SECTION-HEADER-NumberOfRelocations"><a href="#IMAGE-SECTION-HEADER-NumberOfRelocations" class="headerlink" title="IMAGE_SECTION_HEADER.NumberOfRelocations"></a>IMAGE_SECTION_HEADER.NumberOfRelocations</h4><p>+0020h</p>
<p>重定位表的个数</p>
<h4 id="IMAGE-SECTION-HEADER-NumberOfLinenumbers"><a href="#IMAGE-SECTION-HEADER-NumberOfLinenumbers" class="headerlink" title="IMAGE_SECTION_HEADER.NumberOfLinenumbers"></a>IMAGE_SECTION_HEADER.NumberOfLinenumbers</h4><p>+0022h</p>
<p>行号表中行数的数量</p>
<h4 id="IMAGE-SECTION-HEADER-Characteristics"><a href="#IMAGE-SECTION-HEADER-Characteristics" class="headerlink" title="IMAGE_SECTION_HEADER.Characteristics"></a>IMAGE_SECTION_HEADER.Characteristics</h4><p>+0024h</p>
<p>节的属性</p>
<h3 id="解析程序的字节码"><a href="#解析程序的字节码" class="headerlink" title="解析程序的字节码"></a>解析程序的字节码</h3><p><img src="/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/11.png"></p>
<p><img src="/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/12.png"></p>
<p><img src="/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/13.png"></p>
<p><img src="/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/14.png"></p>
<p><img src="/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/15.png"></p>
<h3 id="PE内存映像"><a href="#PE内存映像" class="headerlink" title="PE内存映像"></a>PE内存映像</h3><p>使用OD载入我们的程序，然后点击M或者选择查看-&gt;内存</p>
<p><img src="/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/16.png"></p>
<p>文件字节码在内存中的分布大概为：</p>
<p><strong>PE文件头 + 代码 + 导入表 + 数据</strong></p>
<p>每个部分按照1000h对齐，在Windows中，每个进程有自己独立的4gb内存空间，<strong>所以根据文件字节码中IMAGE_OPTIONAL_HEADER32.ImageBase的建议装入映像基地址的值.</strong></p>
<p><img src="/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/17.png"></p>
</div><div class="article-licensing box"><div class="licensing-title"><p>PE权威指南 - PE文件头</p><p><a href="http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/">http://systemk1t.github.io/2020/10/28/PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-PE%E6%96%87%E4%BB%B6%E5%A4%B4/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>sYstemk1t</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2020-10-28</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2020-11-05</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a class="icon" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a><a class="icon" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Windows-PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97/">Windows-PE权威指南</a></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><div class="social-share"></div><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button donate" href="/" target="_blank" rel="noopener" data-type="afdian"><span class="icon is-small"><i class="fas fa-charging-station"></i></span><span>爱发电</span></a><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>支付宝</span><span class="qrcode"><img src="/img/alipayimg.jpg" alt="支付宝"></span></a><a class="button donate" href="/" target="_blank" rel="noopener" data-type="buymeacoffee"><span class="icon is-small"><i class="fas fa-coffee"></i></span><span>送我杯咖啡</span></a><a class="button donate" href="/" target="_blank" rel="noopener" data-type="patreon"><span class="icon is-small"><i class="fab fa-patreon"></i></span><span>Patreon</span></a><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/img/wechatimg.jpg" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2020/10/30/Windows%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F-%E5%8F%A5%E6%9F%84%E8%A1%A8/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Windows应用程序 - 句柄表</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2020/10/21/Windows%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F-%E8%BF%9B%E7%A8%8B%E5%88%9B%E5%BB%BA/"><span class="level-item">Windows应用程序 - 进程创建</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div class="notification is-danger">You forgot to set the <code>shortname</code> for Disqus. Please set it in <code>_config.yml</code>.</div></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="sYstemk1t"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">sYstemk1t</p><p class="is-size-6 is-block">翩若惊鸿，婉若游龙</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>ShenZhen, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">139</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">21</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">14</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/sYstemk1t" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/sYstemk1t"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#PE文件头"><span class="level-left"><span class="level-item">1</span><span class="level-item">PE文件头</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#文件头基本概念"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">文件头基本概念</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#地址"><span class="level-left"><span class="level-item">1.1.1</span><span class="level-item">地址</span></span></a></li><li><a class="level is-mobile" href="#指针"><span class="level-left"><span class="level-item">1.1.2</span><span class="level-item">指针</span></span></a></li><li><a class="level is-mobile" href="#数据目录"><span class="level-left"><span class="level-item">1.1.3</span><span class="level-item">数据目录</span></span></a></li><li><a class="level is-mobile" href="#节"><span class="level-left"><span class="level-item">1.1.4</span><span class="level-item">节</span></span></a></li><li><a class="level is-mobile" href="#对齐"><span class="level-left"><span class="level-item">1.1.5</span><span class="level-item">对齐</span></span></a></li></ul></li><li><a class="level is-mobile" href="#PE文件格式"><span class="level-left"><span class="level-item">1.2</span><span class="level-item">PE文件格式</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#DOS-Stub"><span class="level-left"><span class="level-item">1.2.1</span><span class="level-item">DOS Stub</span></span></a></li><li><a class="level is-mobile" href="#PE结构解析"><span class="level-left"><span class="level-item">1.2.2</span><span class="level-item">PE结构解析</span></span></a></li></ul></li><li><a class="level is-mobile" href="#PE头分析"><span class="level-left"><span class="level-item">1.3</span><span class="level-item">PE头分析</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#节表项IMAGE-SECTION-HEADER"><span class="level-left"><span class="level-item">1.3.1</span><span class="level-item">节表项IMAGE_SECTION_HEADER</span></span></a></li></ul></li><li><a class="level is-mobile" href="#数据结构字段详解"><span class="level-left"><span class="level-item">1.4</span><span class="level-item">数据结构字段详解</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#IMAGE-NT-HEADERS32-OptionalHeader"><span class="level-left"><span class="level-item">1.4.1</span><span class="level-item">IMAGE_NT_HEADERS32.OptionalHeader</span></span></a></li><li><a class="level is-mobile" href="#IMAGE-FILE-HEADER-Characteristics"><span class="level-left"><span class="level-item">1.4.2</span><span class="level-item">IMAGE_FILE_HEADER.Characteristics</span></span></a></li><li><a class="level is-mobile" href="#IMAGE-OPTIONAL-HEADER32-DataDirectory"><span class="level-left"><span class="level-item">1.4.3</span><span class="level-item">IMAGE_OPTIONAL_HEADER32.DataDirectory</span></span></a></li><li><a class="level is-mobile" href="#IMAGE-DATA-DIRECTORY-Size"><span class="level-left"><span class="level-item">1.4.4</span><span class="level-item">IMAGE_DATA_DIRECTORY.Size</span></span></a></li><li><a class="level is-mobile" href="#IMAGE-SECTION-HEADER-Characteristics"><span class="level-left"><span class="level-item">1.4.5</span><span class="level-item">IMAGE_SECTION_HEADER.Characteristics</span></span></a></li><li><a class="level is-mobile" href="#解析程序的字节码"><span class="level-left"><span class="level-item">1.4.6</span><span class="level-item">解析程序的字节码</span></span></a></li><li><a class="level is-mobile" href="#PE内存映像"><span class="level-left"><span class="level-item">1.4.7</span><span class="level-item">PE内存映像</span></span></a></li></ul></li></ul></li></ul></div></div><style>.menu-list > li > a.is-active + .menu-list { display: block; }.menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://r00tk1ts.github.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">r00tk1t</span></span><span class="level-right"><span class="level-item tag">r00tk1ts.github.io</span></span></a></li><li><a class="level is-mobile" href="https://www.cnblogs.com/yicunyiye/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">yicunyiye</span></span><span class="level-right"><span class="level-item tag">www.cnblogs.com</span></span></a></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/Bugku/"><span class="level-start"><span class="level-item">Bugku</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/C/"><span class="level-start"><span class="level-item">C++</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/C-%E9%BB%91%E5%AE%A2%E7%BC%96%E7%A8%8B/"><span class="level-start"><span class="level-item">C++黑客编程</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/CrackMe/"><span class="level-start"><span class="level-item">CrackMe</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/C%E4%B8%8E%E6%8C%87%E9%92%88/"><span class="level-start"><span class="level-item">C与指针</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/C%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80/"><span class="level-start"><span class="level-item">C程序设计语言</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/MFC/"><span class="level-start"><span class="level-item">MFC</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Windows-API%E5%BC%80%E5%8F%91%E8%AF%A6%E8%A7%A3/"><span class="level-start"><span class="level-item">Windows-API开发详解</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile" href="/categories/Windows-PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97/"><span class="level-start"><span class="level-item">Windows-PE权威指南</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/Windows32%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80%E8%AE%BE%E8%AE%A1/"><span class="level-start"><span class="level-item">Windows32汇编语言设计</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/Windows%E5%86%85%E6%A0%B8%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E7%8E%B0/"><span class="level-start"><span class="level-item">Windows内核原理与实现</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Windows%E6%A0%B8%E5%BF%83%E7%BC%96%E7%A8%8B/"><span class="level-start"><span class="level-item">Windows核心编程</span></span><span class="level-end"><span class="level-item tag">17</span></span></a></li><li><a class="level is-mobile" href="/categories/Windows%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/"><span class="level-start"><span class="level-item">Windows程序设计</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%8A%A0%E5%AF%86%E4%B8%8E%E8%A7%A3%E5%AF%86/"><span class="level-start"><span class="level-item">加密与解密</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%8F%8D%E6%B1%87%E7%BC%96/"><span class="level-start"><span class="level-item">反汇编</span></span><span class="level-end"><span class="level-item tag">25</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/"><span class="level-start"><span class="level-item">汇编语言</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80-%E5%9F%BA%E4%BA%8Ex86%E5%A4%84%E7%90%86%E5%99%A8/"><span class="level-start"><span class="level-item">汇编语言-基于x86处理器</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/"><span class="level-start"><span class="level-item">网络编程</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97/"><span class="level-start"><span class="level-item">逆向工程权威指南</span></span><span class="level-end"><span class="level-item tag">16</span></span></a></li><li><a class="level is-mobile" href="/categories/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86/"><span class="level-start"><span class="level-item">逆向工程核心原理</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/categories/%E9%BB%91%E5%AE%A2%E7%BC%96%E7%A8%8B/"><span class="level-start"><span class="level-item">黑客编程</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-11-08T03:36:25.000Z">2020-11-08</time></p><p class="title"><a href="/2020/11/08/Assembly-%E6%8C%87%E4%BB%A4/">Assembly - 指令</a></p><p class="categories"><a href="/categories/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/">汇编语言</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-11-06T07:11:40.000Z">2020-11-06</time></p><p class="title"><a href="/2020/11/06/Assembly-%E5%AF%BB%E5%9D%80%E6%96%B9%E5%BC%8F/">Assembly - 寻址方式</a></p><p class="categories"><a href="/categories/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/">汇编语言</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-11-04T07:13:16.000Z">2020-11-04</time></p><p class="title"><a href="/2020/11/04/MFC-%E5%9F%BA%E7%A1%80/">MFC - 基础</a></p><p class="categories"><a href="/categories/MFC/">MFC</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-11-04T04:08:14.000Z">2020-11-04</time></p><p class="title"><a href="/2020/11/04/Windows%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F-%E8%BF%9C%E7%A8%8B%E7%BA%BF%E7%A8%8B%E6%B3%A8%E5%85%A5/">Windows应用程序 - 远程线程注入</a></p><p class="categories"><a href="/categories/Windows-API%E5%BC%80%E5%8F%91%E8%AF%A6%E8%A7%A3/">Windows-API开发详解</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-11-04T03:56:25.000Z">2020-11-04</time></p><p class="title"><a href="/2020/11/04/Windows%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F-%E9%9A%90%E5%BC%8F%E9%93%BE%E6%8E%A5/">Windows应用程序 - 隐式链接</a></p><p class="categories"><a href="/categories/Windows-API%E5%BC%80%E5%8F%91%E8%AF%A6%E8%A7%A3/">Windows-API开发详解</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2020/11/"><span class="level-start"><span class="level-item">十一月 2020</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/10/"><span class="level-start"><span class="level-item">十月 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/09/"><span class="level-start"><span class="level-item">九月 2020</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/08/"><span class="level-start"><span class="level-item">八月 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/07/"><span class="level-start"><span class="level-item">七月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/05/"><span class="level-start"><span class="level-item">五月 2020</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/04/"><span class="level-start"><span class="level-item">四月 2020</span></span><span class="level-end"><span class="level-item tag">18</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/01/"><span class="level-start"><span class="level-item">一月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/12/"><span class="level-start"><span class="level-item">十二月 2019</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/11/"><span class="level-start"><span class="level-item">十一月 2019</span></span><span class="level-end"><span class="level-item tag">19</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/10/"><span class="level-start"><span class="level-item">十月 2019</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/09/"><span class="level-start"><span class="level-item">九月 2019</span></span><span class="level-end"><span class="level-item tag">13</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/08/"><span class="level-start"><span class="level-item">八月 2019</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/05/"><span class="level-start"><span class="level-item">五月 2019</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Assembly/"><span class="tag">Assembly</span><span class="tag">37</span></a></div><div class="control"><a class="tags has-addons" href="/tags/C/"><span class="tag">C++</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CTF/"><span class="tag">CTF</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CrackMe/"><span class="tag">CrackMe</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/HOOK/"><span class="tag">HOOK</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hacker/"><span class="tag">Hacker</span><span class="tag">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MFC/"><span class="tag">MFC</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Reverse/"><span class="tag">Reverse</span><span class="tag">24</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Scoket/"><span class="tag">Scoket</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Windows-Kernel/"><span class="tag">Windows-Kernel</span><span class="tag">16</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Windows-PE%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97/"><span class="tag">Windows-PE权威指南</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Windows%E6%A0%B8%E5%BF%83%E7%BC%96%E7%A8%8B/"><span class="tag">Windows核心编程</span><span class="tag">20</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Windows%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1/"><span class="tag">Windows程序设计</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/c/"><span class="tag">c</span><span class="tag">8</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">订阅更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="订阅"></div></div></form></div></div></div><div class="card widget"><div class="card-content"><div class="notification is-danger">You need to set <code>client_id</code> and <code>slot_id</code> to show this AD unit. Please set it in <code>_config.yml</code>.</div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/head.jpg" alt="sYstemk1t&#039;s blog" height="28"></a><p class="is-size-7"><span>&copy; 2020 sYstemk1t</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" async></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>